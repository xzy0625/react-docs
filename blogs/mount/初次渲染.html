<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>é¦–æ¬¡æ¸²æŸ“ | react18æºç è§£æ</title>
    <meta name="description" content="reactç›¸å…³å­¦ä¹ æ–‡æ¡£">
    <meta name="generator" content="VitePress v1.5.0">
    <link rel="preload stylesheet" href="/react-docs/assets/style.C9x576y_.css" as="style">
    <link rel="preload stylesheet" href="/react-docs/vp-icons.css" as="style">
    
    <script type="module" src="/react-docs/assets/app.DzeMVPMu.js"></script>
    <link rel="preload" href="/react-docs/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/react-docs/assets/chunks/theme.DjjZb5L-.js">
    <link rel="modulepreload" href="/react-docs/assets/chunks/framework.B883bhfp.js">
    <link rel="modulepreload" href="/react-docs/assets/blogs_mount_åˆæ¬¡æ¸²æŸ“.md.Da09jFKp.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-5d98c3a5><!--[--><!--]--><!--[--><span tabindex="-1" data-v-0f60ec36></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-0f60ec36> Skip to content </a><!--]--><!----><header class="VPNav" data-v-5d98c3a5 data-v-ae24b3ad><div class="VPNavBar" data-v-ae24b3ad data-v-6aa21345><div class="wrapper" data-v-6aa21345><div class="container" data-v-6aa21345><div class="title" data-v-6aa21345><div class="VPNavBarTitle has-sidebar" data-v-6aa21345 data-v-1168a8e4><a class="title" href="/react-docs/" data-v-1168a8e4><!--[--><!--]--><!--[--><img class="VPImage logo" src="/react-docs/images/logo.png" alt data-v-8426fc1a><!--]--><span data-v-1168a8e4>react18æºç è§£æ</span><!--[--><!--]--></a></div></div><div class="content" data-v-6aa21345><div class="content-body" data-v-6aa21345><!--[--><!--]--><div class="VPNavBarSearch search" data-v-6aa21345><!--[--><!----><div id="docsearch"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><span class="vp-icon DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-6aa21345 data-v-dc692963><span id="main-nav-aria-label" class="visually-hidden" data-v-dc692963> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/react-docs/blogs/blog1/" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>ğŸ”¥å‰ç«¯ç®—æ³•(ç¼–å†™ä¸­)</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/react-docs/blogs/blog1/" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>ğŸ’­å­¦ä¹ åœˆå­(ç¼–å†™ä¸­)</span><!--]--></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-dc692963 data-v-cf11d7a2><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-cf11d7a2><span class="text" data-v-cf11d7a2><!----><span data-v-cf11d7a2>å…¶ä»–</span><span class="vpi-chevron-down text-icon" data-v-cf11d7a2></span></span></button><div class="menu" data-v-cf11d7a2><div class="VPMenu" data-v-cf11d7a2 data-v-b98bc113><div class="items" data-v-b98bc113><!--[--><!--[--><div class="VPMenuLink" data-v-b98bc113 data-v-35975db6><a class="VPLink link" href="/react-docs/others/changelog.html" data-v-35975db6><!--[--><span data-v-35975db6>Changelog</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-b98bc113 data-v-35975db6><a class="VPLink link" href="/react-docs/others/contribution.html" data-v-35975db6><!--[--><span data-v-35975db6>Contribution</span><!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-6aa21345 data-v-6c893767><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-6c893767 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-6aa21345 data-v-0394ad82 data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://github.com/xzy0625/react-docs" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-bd121fe5><span class="vpi-social-github"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-6aa21345 data-v-bb2aa2f0 data-v-cf11d7a2><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-cf11d7a2><span class="vpi-more-horizontal icon" data-v-cf11d7a2></span></button><div class="menu" data-v-cf11d7a2><div class="VPMenu" data-v-cf11d7a2 data-v-b98bc113><!----><!--[--><!--[--><!----><div class="group" data-v-bb2aa2f0><div class="item appearance" data-v-bb2aa2f0><p class="label" data-v-bb2aa2f0>Appearance</p><div class="appearance-action" data-v-bb2aa2f0><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-bb2aa2f0 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div></div></div><div class="group" data-v-bb2aa2f0><div class="item social-links" data-v-bb2aa2f0><div class="VPSocialLinks social-links-list" data-v-bb2aa2f0 data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://github.com/xzy0625/react-docs" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-bd121fe5><span class="vpi-social-github"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-6aa21345 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><div class="divider" data-v-6aa21345><div class="divider-line" data-v-6aa21345></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-5d98c3a5 data-v-a6f0e41e><div class="container" data-v-a6f0e41e><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-a6f0e41e><span class="vpi-align-left menu-icon" data-v-a6f0e41e></span><span class="menu-text" data-v-a6f0e41e>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-a6f0e41e data-v-17a5e62e><button data-v-17a5e62e>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-5d98c3a5 data-v-319d5ca6><div class="curtain" data-v-319d5ca6></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-319d5ca6><span class="visually-hidden" id="sidebar-aria-label" data-v-319d5ca6> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 collapsible collapsed" data-v-c40bc020 data-v-b7550ba0><div class="item" role="button" tabindex="0" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><h2 class="text" data-v-b7550ba0>å¼€å§‹</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b7550ba0><span class="vpi-chevron-right caret-icon" data-v-b7550ba0></span></div></div><div class="items" data-v-b7550ba0><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/react-docs/blogs/start/%E4%B8%BA%E4%BB%80%E4%B9%88%E5%AD%A6%E4%B9%A0%E6%BA%90%E7%A0%81.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>ä¸ºä»€ä¹ˆè¦å­¦ä¹ æºç </p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/react-docs/blogs/start/%E6%BA%90%E7%A0%81%E7%BB%93%E6%9E%84.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>æºç ç»“æ„</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/react-docs/blogs/start/%E5%A6%82%E4%BD%95%E8%B0%83%E8%AF%95%E6%BA%90%E7%A0%81.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>å¦‚ä½•è°ƒè¯•æºç </p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/react-docs/blogs/start/%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>å‚è€ƒèµ„æ–™</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/react-docs/blogs/start/%E9%9A%8F%E6%84%8F%E8%AE%B0%E5%BD%95.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>éšæ„è®°å½•</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 collapsible collapsed has-active" data-v-c40bc020 data-v-b7550ba0><div class="item" role="button" tabindex="0" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><h2 class="text" data-v-b7550ba0>åˆæ¬¡æ¸²æŸ“</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b7550ba0><span class="vpi-chevron-right caret-icon" data-v-b7550ba0></span></div></div><div class="items" data-v-b7550ba0><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/react-docs/blogs/mount/%E5%88%9D%E6%AC%A1%E6%B8%B2%E6%9F%93.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>åˆæ¬¡æ¸²æŸ“æ¦‚è§ˆ</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 collapsible collapsed" data-v-c40bc020 data-v-b7550ba0><div class="item" role="button" tabindex="0" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><h2 class="text" data-v-b7550ba0>æ›´æ–°</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b7550ba0><span class="vpi-chevron-right caret-icon" data-v-b7550ba0></span></div></div><div class="items" data-v-b7550ba0><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/react-docs/blogs/update/index.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>æ›´æ–°æ¦‚è§ˆ</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 collapsible collapsed" data-v-c40bc020 data-v-b7550ba0><div class="item" role="button" tabindex="0" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><h2 class="text" data-v-b7550ba0>è°ƒåº¦å™¨scheduler</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b7550ba0><span class="vpi-chevron-right caret-icon" data-v-b7550ba0></span></div></div><div class="items" data-v-b7550ba0><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/react-docs/blogs/schduler/scheduler_and_concurrent.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>è°ƒåº¦å™¨å’Œå¹¶å‘æœºåˆ¶</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 collapsible collapsed" data-v-c40bc020 data-v-b7550ba0><div class="item" role="button" tabindex="0" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><h2 class="text" data-v-b7550ba0>äº‹ä»¶ç³»ç»Ÿ</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b7550ba0><span class="vpi-chevron-right caret-icon" data-v-b7550ba0></span></div></div><div class="items" data-v-b7550ba0><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/react-docs/blogs/evnetSystem/eventSystem.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>äº‹ä»¶ç³»ç»Ÿæ¦‚è§ˆ</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 collapsible collapsed" data-v-c40bc020 data-v-b7550ba0><div class="item" role="button" tabindex="0" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><h2 class="text" data-v-b7550ba0>å‡½æ•°ç»„ä»¶</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b7550ba0><span class="vpi-chevron-right caret-icon" data-v-b7550ba0></span></div></div><div class="items" data-v-b7550ba0><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/react-docs/blogs/functionComp/index.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>å‡½æ•°ç»„ä»¶æ¦‚è§ˆ</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 collapsible collapsed" data-v-c40bc020 data-v-b7550ba0><div class="item" role="button" tabindex="0" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><h2 class="text" data-v-b7550ba0>ç±»ç»„ä»¶</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b7550ba0><span class="vpi-chevron-right caret-icon" data-v-b7550ba0></span></div></div><div class="items" data-v-b7550ba0><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/react-docs/blogs/classComp/index.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>ç±»ç»„ä»¶æ¦‚è§ˆ</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 collapsible collapsed" data-v-c40bc020 data-v-b7550ba0><div class="item" role="button" tabindex="0" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><h2 class="text" data-v-b7550ba0>å…¶ä»–ç»„ä»¶</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b7550ba0><span class="vpi-chevron-right caret-icon" data-v-b7550ba0></span></div></div><div class="items" data-v-b7550ba0><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/react-docs/blogs/otherComp/teleport.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>teleport</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 collapsible collapsed" data-v-c40bc020 data-v-b7550ba0><div class="item" role="button" tabindex="0" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><h2 class="text" data-v-b7550ba0>hooks</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b7550ba0><span class="vpi-chevron-right caret-icon" data-v-b7550ba0></span></div></div><div class="items" data-v-b7550ba0><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/react-docs/blogs/hooks/index.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>hooksæ¦‚è§ˆ</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/react-docs/blogs/hooks/useState.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>useState</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 collapsible collapsed" data-v-c40bc020 data-v-b7550ba0><div class="item" role="button" tabindex="0" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><h2 class="text" data-v-b7550ba0>ä¼˜å…ˆçº§</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b7550ba0><span class="vpi-chevron-right caret-icon" data-v-b7550ba0></span></div></div><div class="items" data-v-b7550ba0><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/react-docs/blogs/lanes/index.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>ä¼˜å…ˆçº§</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 collapsible collapsed" data-v-c40bc020 data-v-b7550ba0><div class="item" role="button" tabindex="0" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><h2 class="text" data-v-b7550ba0>å…¶ä»–ä¸€äº›æ€»ç»“</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b7550ba0><span class="vpi-chevron-right caret-icon" data-v-b7550ba0></span></div></div><div class="items" data-v-b7550ba0><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/react-docs/blogs/summary/%E5%90%84%E7%A7%8D%E5%85%83%E7%B4%A0%E7%9A%84fiber%E8%8A%82%E7%82%B9%E5%B1%9E%E6%80%A7.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>å„ç§å…ƒç´ çš„fiberèŠ‚ç‚¹å±æ€§</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/react-docs/blogs/summary/%E8%8E%B7%E5%8F%96%E5%AD%90%E5%85%83%E7%B4%A0%E6%80%BB%E7%BB%93.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>è·å–å­å…ƒç´ æ€»ç»“</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/react-docs/blogs/summary/%E6%B8%B2%E6%9F%93%E6%80%BB%E7%BB%93.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>æ¸²æŸ“æ€»ç»“</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 collapsible collapsed" data-v-c40bc020 data-v-b7550ba0><div class="item" role="button" tabindex="0" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><h2 class="text" data-v-b7550ba0>æ€§èƒ½æå‡</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b7550ba0><span class="vpi-chevron-right caret-icon" data-v-b7550ba0></span></div></div><div class="items" data-v-b7550ba0><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/react-docs/blogs/performace/index.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>æ€§èƒ½æå‡</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 collapsible collapsed" data-v-c40bc020 data-v-b7550ba0><div class="item" role="button" tabindex="0" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><h2 class="text" data-v-b7550ba0>ä¸€äº›ä¾‹å­</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b7550ba0><span class="vpi-chevron-right caret-icon" data-v-b7550ba0></span></div></div><div class="items" data-v-b7550ba0><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/react-docs/blogs/example/clickAndTransition.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>reactåŸç”Ÿé˜²æŠ–æ€ªè±¡</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/react-docs/blogs/example/%E5%A5%87%E6%80%AA%E7%9A%84useEffect.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>å¥‡æ€ªçš„useEffect</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-5d98c3a5 data-v-1428d186><div class="VPDoc has-sidebar has-aside" data-v-1428d186 data-v-39a288b8><!--[--><!--]--><div class="container" data-v-39a288b8><div class="aside" data-v-39a288b8><div class="aside-curtain" data-v-39a288b8></div><div class="aside-container" data-v-39a288b8><div class="aside-content" data-v-39a288b8><div class="VPDocAside" data-v-39a288b8 data-v-3f215769><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-3f215769 data-v-a5bbad30><div class="content" data-v-a5bbad30><div class="outline-marker" data-v-a5bbad30></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-a5bbad30>On this page</div><ul class="VPDocOutlineItem root" data-v-a5bbad30 data-v-b933a997><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-39a288b8><div class="content-container" data-v-39a288b8><!--[--><!--]--><main class="main" data-v-39a288b8><div style="position:relative;" class="vp-doc _react-docs_blogs_mount_%E5%88%9D%E6%AC%A1%E6%B8%B2%E6%9F%93" data-v-39a288b8><div><h1 id="é¦–æ¬¡æ¸²æŸ“" tabindex="-1">é¦–æ¬¡æ¸²æŸ“ <a class="header-anchor" href="#é¦–æ¬¡æ¸²æŸ“" aria-label="Permalink to &quot;é¦–æ¬¡æ¸²æŸ“&quot;">â€‹</a></h1><h2 id="åº”ç”¨å…¥å£" tabindex="-1">åº”ç”¨å…¥å£ <a class="header-anchor" href="#åº”ç”¨å…¥å£" aria-label="Permalink to &quot;åº”ç”¨å…¥å£&quot;">â€‹</a></h2><p>æ ¹æ®<code>React18</code>ç‰ˆæœ¬ï¼Œæ¯ä¸€ä¸ª<code>React</code>åº”ç”¨çš„å…¥å£éƒ½æ˜¯ä»<code>react-dom</code>è¿™ä¸ªæºç åŒ…ä¸­å¼•å…¥ä¸€ä¸ª<code>ReactDOM</code>å¯¹è±¡ï¼Œç„¶åè°ƒç”¨<code>createRoot</code>æ–¹æ³•è¿›è¡Œä¸€ç³»åˆ—çš„åˆå§‹åŒ–å‡†å¤‡ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šè¿”å›ä¸€ä¸ª<code>root</code>å¯¹è±¡ã€<code>ReactDOMRoot</code>æ„é€ å‡½æ•°çš„å®ä¾‹ã€‘ï¼Œæœ€åè°ƒç”¨<code>root.render()</code>æ–¹æ³•å¼€å§‹ä¸€ä¸ª<code>React</code>åº”ç”¨çš„åŠ è½½æ¸²æŸ“ã€‚</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> React </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;react&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ReactDOM </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;react-dom/client&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> root</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ReactDOM.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createRoot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(document.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getElementById</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;root&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">root.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">render</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">App</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /&gt;);</span></span></code></pre></div><p>æ‰€ä»¥æ¥ä¸‹æ¥æˆ‘ä»¬å°±ä»<code>createRoot</code>å…¥æ‰‹å¤§æ¦‚äº†è§£ä¸‹<code>react</code>é¦–æ¬¡æ¸²æŸ“çš„åŸºæœ¬æµç¨‹</p><h3 id="createroot" tabindex="-1">createRoot <a class="header-anchor" href="#createroot" aria-label="Permalink to &quot;createRoot&quot;">â€‹</a></h3><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// packages\react-dom\src\client\ReactDOM.js</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createRoot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  container</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Element</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Document</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> DocumentFragment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  options</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> CreateRootOptions</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> RootType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createRootImpl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(container, options);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><code>createRoot</code>ä¸»è¦å°±æ˜¯è°ƒç”¨<code>createRootImpl</code>ã€‚è¿™é‡Œ<code>createRootImpl</code>æ–¹æ³•ä¸º<code>ReactDOMRoot.js</code>æ–‡ä»¶ä¸­çš„<code>createRoot</code>æ–¹æ³•ã€‚</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// packages\react-dom\src\client\ReactDOMRoot.js</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createRoot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  container</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Element</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Document</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> DocumentFragment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// container: é»˜è®¤æ˜¯#root domå…ƒç´ </span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  options</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> CreateRootOptions</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> RootType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // æ ¡éªŒcontaineræ˜¯å¦ä¸ºåˆæ³•çš„domå…ƒç´ </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isValidContainer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(container)) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    throw</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;createRoot(...): Target container is not a DOM element.&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // å¼€å‘ç¯å¢ƒæ ¡éªŒè­¦å‘Š</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  warnIfReactDOMContainerInDEV</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(container);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // é»˜è®¤ä¸¥æ ¼æ¨¡å¼ä¸ºfalse</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> isStrictMode </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> concurrentUpdatesByDefaultOverride </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> identifierPrefix </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> onRecoverableError </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> defaultOnRecoverableError;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> transitionCallbacks </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // åˆ›å»ºrootåº”ç”¨æ ¹èŠ‚ç‚¹å¯¹è±¡,ä¸ºFiberRootNodeç±»å‹: </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // æ³¨ï¼šConcurrentRootä¸º1ï¼Œä»£è¡¨äº†v18ç‰ˆæœ¬çš„å¹¶å‘æ¸²æŸ“æ¨¡å¼</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> root</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createContainer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    container,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ConcurrentRoot, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 1 é»˜è®¤å¼€å¯å¹¶å‘æ¨¡å¼</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    isStrictMode,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    concurrentUpdatesByDefaultOverride,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    identifierPrefix,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    onRecoverableError,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    transitionCallbacks,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  );</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ç»™#root DOMå…ƒç´ è®¾ç½®ä¸€ä¸ªå†…éƒ¨å±æ€§ï¼Œå­˜å‚¨root.current å³HostFiberå¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  markContainerAsRoot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(root.current, container);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> rootContainerElement</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Document</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Element</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> DocumentFragment</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    container.nodeType </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> COMMENT_NODE</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      ?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (container.parentNode: any)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      :</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> container;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ç›‘å¬[#root domå…ƒç´ ]çš„æ‰€æœ‰äº‹ä»¶</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  listenToAllSupportedEvents</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(rootContainerElement);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  # åˆ›å»ºReactDOMRootå®ä¾‹å¯¹è±¡å¹¶è¿”å› å°†rootåº”ç”¨æ ¹èŠ‚ç‚¹å¯¹è±¡ å­˜å‚¨ä¸ºReactDOMçš„å†…éƒ¨å¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ReactDOMRoot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(root);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><code>createRoot</code>æ–¹æ³•é¦–å…ˆå¯¹ä¼ å…¥çš„<code>container</code>ã€<code>#root</code>ã€‘å®¹å™¨å…ƒç´ è¿›è¡Œåˆæ³•æ ¡éªŒï¼š</p><ul><li>æ ¡éªŒå¤±è´¥ï¼ŒæŠ›å‡ºå¼‚å¸¸ï¼Œåœæ­¢åº”ç”¨åŠ è½½ã€‚</li><li>æ ¡éªŒæˆåŠŸï¼Œç»§ç»­å‘ä¸‹æ‰§è¡Œåº”ç”¨åŠ è½½ã€‚</li></ul><p>ç„¶ååˆå§‹åŒ–äº†ä¸€äº›é»˜è®¤çš„çŠ¶æ€ï¼Œè¿™ä¸ªæœ‰ä¸€ä¸ªå˜é‡éœ€è¦æ³¨æ„ï¼š</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> isStrictMode </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><p><code>react18</code>é»˜è®¤æ²¡æœ‰å¼€å¯ä¸¥æ ¼æ¨¡å¼ï¼Œéœ€è¦è‡ªå·±ä½¿ç”¨<code>&lt;StrictMode&gt;</code> ç»„ä»¶åŒ…è£¹<code>App</code>æ ¹ç»„ä»¶ï¼Œæ‰èƒ½å¼€å¯æ•´ä¸ªåº”ç”¨çš„ä¸¥æ ¼æ¨¡å¼ã€‚</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">StrictMode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">App</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">StrictMode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span></code></pre></div><p>ä½†æ˜¯React18ä¼šé»˜è®¤å¼€å¯<strong>å¹¶å‘æ¸²æŸ“æ¨¡å¼</strong>ï¼š</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å†å²é—ç•™æ¨¡å¼ï¼Œé’ˆå¯¹16ï¼Œ17ç‰ˆæœ¬</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">LegacyRoot </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å¹¶å‘æ¨¡å¼ã€react18é»˜è®¤å¼€å¯ã€‘</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ConcurrentRoot </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><p><code>createRoot</code>æ–¹æ³•ä¸­ä¸»è¦æœ‰ä¸‰ä¸ªé‡ç‚¹é€»è¾‘å¤„ç†ï¼š</p><ul><li>è°ƒç”¨<code>createContainer</code>æ–¹æ³•ï¼Œåˆ›å»º<code>root</code>åº”ç”¨æ ¹èŠ‚ç‚¹å¯¹è±¡ã€‚</li><li>åœ¨<code>#root</code>åº”ç”¨å®¹å™¨å…ƒç´ ä¸Šç›‘å¬æ‰€æœ‰äº‹ä»¶ï¼Œè¿™æ˜¯<code>React</code>äº‹ä»¶ç³»ç»Ÿçš„å…³é”®ã€‚</li><li>åˆ›å»ºä¸€ä¸ª<code>ReactDOMRoot</code>å®ä¾‹å¯¹è±¡å¹¶è¿”å›ï¼Œè¿™å°±æ˜¯<code>createRoot</code>æ–¹æ³•æœ€åè¿”å›çš„<code>root</code>å¯¹è±¡ã€‚</li></ul><p>ä¸‹é¢æˆ‘ä»¬å¼€å§‹é€ä¸ªè§£ææ¯ä¸ªé€»è¾‘è¿‡ç¨‹ã€‚</p><h4 id="createcontainer" tabindex="-1">createContainer <a class="header-anchor" href="#createcontainer" aria-label="Permalink to &quot;createContainer&quot;">â€‹</a></h4><p>é¦–å…ˆè¿›å…¥<code>createContainer</code>æºç ï¼š</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// packages\react-reconciler\src\ReactFiberReconciler.new.js</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createContainer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  containerInfo</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Container</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  tag</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> RootTag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  hydrationCallbacks</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> SuspenseHydrationCallbacks</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  isStrictMode</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> boolean</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  concurrentUpdatesByDefaultOverride</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> boolean</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  identifierPrefix</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  onRecoverableError</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">error</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> mixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  transitionCallbacks</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> TransitionTracingCallbacks</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> OpaqueRoot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // æ‰€æœ‰å¸¦æœ‰hydrateçš„éƒ½ä»£è¡¨ssrï¼Œé»˜è®¤ä¸ºfalseï¼Œæˆ‘ä»¬åç»­éƒ½ä¼šå¿½è§†è¿™ä¸€æ®µé€»è¾‘</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> hydrate</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> initialChildren</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // åªè°ƒç”¨äº†ä¸€ä¸ªæ–¹æ³•</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createFiberRoot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    containerInfo,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    tag,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    hydrate,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    initialChildren,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    hydrationCallbacks,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    isStrictMode,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    concurrentUpdatesByDefaultOverride,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    identifierPrefix,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    onRecoverableError,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    transitionCallbacks,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>ç»§ç»­æŸ¥çœ‹<code>createFiberRoot</code>æºç ï¼š</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// packages\react-reconciler\src\ReactFiberRoot.new.js</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// åˆ›å»ºrootåº”ç”¨æ ¹èŠ‚ç‚¹å¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createFiberRoot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  containerInfo</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> any</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  tag</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> RootTag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  hydrate</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> boolean</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> FiberRoot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // åˆ›å»ºrootåº”ç”¨æ ¹èŠ‚ç‚¹å¯¹è±¡ ã€FiberRootNodeã€‘</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> root</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> FiberRoot</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> FiberRootNode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    containerInfo,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    tag, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    hydrate,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    identifierPrefix,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    onRecoverableError,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  );</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // åˆ›å»ºä¸€ä¸ªFiberNodeå¯¹è±¡ã€HostRootFiberã€‘ï¼Œå®ƒæ˜¯Fiberæ ‘çš„æ ¹èŠ‚ç‚¹ï¼Œéå¸¸é‡è¦</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> uninitializedFiber</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createHostRootFiber</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    tag,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    isStrictMode,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    concurrentUpdatesByDefaultOverride,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ã€å…³è”èµ·æ¥ï¼Œä»¥ä¾¿åœ¨åç»­çš„æ¸²æŸ“è¿‡ç¨‹ä¸­èƒ½å¤Ÿæ­£ç¡®åœ°å¤„ç†è¯¥ç»„ä»¶æ ‘çš„æ›´æ–°å’Œé‡æ–°æ¸²æŸ“ã€‚ã€‘</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // å°†rootåº”ç”¨æ ¹èŠ‚ç‚¹å¯¹è±¡çš„currentå±æ€§ æŒ‡å‘äº†å½“å‰Current Fiber Treeç»„ä»¶æ ‘çš„æ ¹èŠ‚ç‚¹ã€HostRootFiberã€‘</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  root.current </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> uninitializedFiber;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ç„¶åå°†HostFiber.stateNodeå±æ€§å€¼ï¼šè®¾ç½®ä¸ºrootåº”ç”¨æ ¹èŠ‚ç‚¹å¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  uninitializedFiber.stateNode </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> root;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (enableCache) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> initialCache</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createCache</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    retainCache</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(initialCache);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    root.pooledCache </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> initialCache;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    retainCache</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(initialCache);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> initialState</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> RootState</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      element: initialChildren,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      isDehydrated: hydrate,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      cache: initialCache,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      transitions: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      pendingSuspenseBoundaries: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    };</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    uninitializedFiber.memoizedState </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> initialState;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> initialState</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> RootState</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      element: initialChildren,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      isDehydrated: hydrate,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      cache</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">null</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> any</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// not enabled yet</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      transitions: null,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      pendingSuspenseBoundaries: null,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    };</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // åˆå§‹åŒ–æ•°æ®ã€‚memoizedStateå­˜å‚¨çš„æ˜¯ç»„ä»¶ä¸Šçš„ä¸€äº›æ•°æ®ï¼Œåç»­hooksä¹Ÿä¼šç”¨åˆ°è¿™ä¸ªå±æ€§</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    uninitializedFiber.memoizedState = initialState;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // åˆå§‹åŒ–HostRootFiberæ ¹èŠ‚ç‚¹å¯¹è±¡çš„updateQueueå±æ€§ã€‚æ‰€æœ‰äº§ç”Ÿçš„æ›´æ–°éƒ½ä¼šåœ¨fiberçš„updateä¸Š</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  initializeUpdateQueue(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">uninitializedFiber</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  # è¿”å›rootåº”ç”¨æ ¹èŠ‚ç‚¹å¯¹è±¡ã€å®¹å™¨ã€‘</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  return root;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><code>createFiberRoot</code>æ–¹æ³•ä¸€è¿›æ¥å°±åˆ›å»ºäº†ä¸€ä¸ª<code>root</code>å®ä¾‹å¯¹è±¡ï¼Œå®ƒçš„ç±»å‹ä¸º<code>FiberRootNode</code>ã€‚</p><p>å®ƒæ˜¯æ ¹æ®<code>#root</code>å®¹å™¨å…ƒç´ åˆ›å»ºçš„å¯¹è±¡ï¼Œå¯ä»¥ç§°ä¸º<strong>åº”ç”¨æ ¹èŠ‚ç‚¹</strong>ã€‚æˆ‘ä»¬ä¸€äº›æ›´æ–°çš„å…¨å±€æ•°æ®éƒ½æŒ‚è½½åœ¨è¿™ä¸ªå¯¹è±¡ä¸Šã€‚</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> root</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> FiberRootNode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span></code></pre></div><p>æˆ‘ä»¬è¦ç†è§£è¿™ä¸ªå¯¹è±¡çš„å†…å®¹ï¼Œå°±è¦æŸ¥çœ‹<code>FiberRootNode</code>æ„é€ å‡½æ•°ï¼š</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> FiberRootNode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  containerInfo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  tag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  hydrate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  identifierPrefix</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  onRecoverableError</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.tag </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tag; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// åº”ç”¨æ¨¡å¼ï¼š1 è¡¨ç¤ºå¹¶å‘æ¸²æŸ“æ¨¡å¼</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.containerInfo </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> containerInfo; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å­˜å‚¨#root domå¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.pendingChildren </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.current </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; # è¿™ä¸ªå±æ€§æŒ‡å‘Current Fiber Treeçš„æ ¹èŠ‚ç‚¹ ä¹Ÿå°±æ˜¯HostFiberRoot</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.pingCache </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.finishedWork </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å­˜å‚¨åˆ›å»ºå®Œæˆçš„FiberTree</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.timeoutHandle </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> noTimeout;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.context </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.pendingContext </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.callbackNode </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å›è°ƒèŠ‚ç‚¹ï¼Œå­˜å‚¨å½“å‰ä»»åŠ¡task</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.callbackPriority </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> NoLane; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å›è°ƒä»»åŠ¡ä¼˜å…ˆçº§</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.eventTimes </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createLaneMap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(NoLanes); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ ‡è¯†å“ªä¸ªä¼˜å…ˆçº§åœ¨æ¸²æŸ“</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.expirationTimes </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createLaneMap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(NoTimestamp); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// äº‹ä»¶é¥¥é¥¿ç›¸å…³</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.pendingLanes </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> NoLanes; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è¦æ¸²æŸ“çš„ä¼˜å…ˆçº§ã€‚é»˜è®¤ 0</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.suspendedLanes </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> NoLanes;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.pingedLanes </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> NoLanes;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.expiredLanes </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> NoLanes; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è¿‡æœŸçš„ä¼˜å…ˆçº§</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.mutableReadLanes </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> NoLanes;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.finishedLanes </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> NoLanes;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.entangledLanes </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> NoLanes;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.entanglements </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createLaneMap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(NoLanes);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>ä¸‹å›¾ç¤ºä¾‹ï¼šä¸º<code>debug</code>è°ƒè¯•ä¸­åˆ›å»ºçš„<code>FiberRootNode</code>å®ä¾‹å¯¹è±¡ï¼š</p><p><img src="/react-docs/assets/image-20241112201517730.C5Df6IbH.png" alt="image-20241112201517730"></p><p><code>FiberRootNode</code>ä¸­çš„å®ä¾‹å±æ€§å¾ˆå¤šï¼Œæˆ‘ä»¬åªéœ€è¦å…ˆäº†è§£å‡ ä¸ªå¸¸ç”¨çš„ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬ç»§ç»­å›åˆ°<code>createFiberRoot</code>æ–¹æ³•ï¼Œç„¶ååˆåˆ›å»ºäº†ä¸€ä¸ª<code>Fiber</code>å¯¹è±¡ï¼š</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// hostFiber</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> uninitializedFiber</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createHostRootFiber</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// packages\react-reconciler\src\ReactFiber.new.js</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createHostRootFiber</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  tag</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> RootTag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 1</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  isStrictMode</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> boolean</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  concurrentUpdatesByDefaultOverride</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> boolean</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Fiber</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> mode;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  ...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> çœç•¥</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // åˆ›å»ºFiberå¯¹è±¡ tagä¸º3å³ä»£è¡¨HostRootèŠ‚ç‚¹ </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createFiber</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(HostRoot, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, mode);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>æŸ¥çœ‹<code>createFiber</code>æ–¹æ³•ï¼Œè¿™ä¸ªå†…éƒ¨ç›´æ¥è°ƒç”¨<code>FiberNode</code>æ„é€ å‡½æ•°ï¼Œåˆ›å»ºäº†ä¸€ä¸ª<code>Fiber</code>å¯¹è±¡ï¼š</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createFiber</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  tag</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> WorkTag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  pendingProps</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> mixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  mode</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> TypeOfMode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Fiber</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // åˆ›å»ºFiberNodeå®ä¾‹å¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> FiberNode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(tag, pendingProps, key, mode);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre></div><h5 id="fibernode" tabindex="-1">FiberNode <a class="header-anchor" href="#fibernode" aria-label="Permalink to &quot;FiberNode&quot;">â€‹</a></h5><p>ç»§ç»­æŸ¥çœ‹<code>FiberNode</code>æ„é€ å‡½æ•°ï¼š</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> FiberNode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  tag</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> WorkTag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  pendingProps</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> mixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  mode</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> TypeOfMode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Instance</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.tag </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tag; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// èŠ‚ç‚¹ç±»å‹ï¼Œéå¸¸é‡è¦ï¼Œä¸åŒçš„å€¼ä»£è¡¨ä¸åŒçš„èŠ‚ç‚¹å¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.key </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> key; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// èŠ‚ç‚¹key</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.elementType </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å¤§éƒ¨åˆ†æƒ…å†µåŒtypeï¼Œå­˜å‚¨ç»„ä»¶å¯¹è±¡Element</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.type </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; # ç»„ä»¶åŸå§‹å®šä¹‰</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // å­˜å‚¨FiberNodeå¯¹è±¡å¯¹åº”çš„domå…ƒç´ ã€hostCompoentã€‘ï¼Œ</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // å‡½æ•°ç»„ä»¶æ­¤å±æ€§æ— å€¼ï¼Œ</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ç±»ç»„ä»¶æ­¤å±æ€§å­˜å‚¨çš„æ˜¯ç»„ä»¶å®ä¾‹instance</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.stateNode </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  # FiberNodeèŠ‚ç‚¹ä¹‹é—´çš„é“¾æ¥</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.return </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æŒ‡å‘çˆ¶çº§èŠ‚ç‚¹å¯¹è±¡FiberNode</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.child </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æŒ‡å‘ç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹FiberNode</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.sibling </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æŒ‡å‘ä¸‹ä¸€ä¸ªå…„å¼ŸèŠ‚ç‚¹FiberNode</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.index </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.ref </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// refå¼•ç”¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  # hooksç›¸å…³</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.pendingProps </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pendingProps; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ–°çš„ï¼Œç­‰å¾…å¤„ç†çš„props</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.memoizedProps </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ—§çš„ï¼Œä¸Šä¸€æ¬¡å­˜å‚¨çš„props</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.updateQueue </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å­˜å‚¨updateæ›´æ–°å¯¹è±¡é“¾è¡¨</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.memoizedState </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ç±»ç»„ä»¶ï¼šæ—§çš„ï¼Œä¸Šä¸€æ¬¡å­˜å‚¨çš„state; å‡½æ•°ç»„ä»¶ï¼šå­˜å‚¨hooké“¾è¡¨</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.dependencies </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.mode </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> mode; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å­˜å‚¨çš„æ˜¯å½“å‰åº”ç”¨æ¸²æŸ“æ¨¡å¼ï¼šé»˜è®¤æ˜¯concurrent mode</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // å„ç§effectå‰¯ä½œç”¨ç›¸å…³çš„æ‰§è¡Œæ ‡è®°</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.flags </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> NoFlags;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.subtreeFlags </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> NoFlags; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å­æ ‘èŠ‚ç‚¹çš„å‰¯ä½œç”¨æ ‡è®°ï¼Œé»˜è®¤æ— å‰¯ä½œç”¨</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.deletions </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// åˆ é™¤æ ‡è®°</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ä¼˜å…ˆçº§è°ƒåº¦ï¼Œé»˜è®¤ä¸º0</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.lanes </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> NoLanes; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// èŠ‚ç‚¹è‡ªèº«çš„æ›´æ–°Lanes</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.childLanes </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> NoLanes; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å­æ ‘èŠ‚ç‚¹çš„æ›´æ–°lanes</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  # è¿™ä¸ªå±æ€§æŒ‡å‘å¦å¤–ä¸€ä¸ªç¼“å†²åŒºå¯¹åº”çš„FiberNode</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // current.alternate === workInProgress</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // workInProgress.alternate === current</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.alternate </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>å¯ä»¥çœ‹åˆ°<code>FiberNode</code>åŒæ ·å®šä¹‰äº†å¾ˆå¤šçš„å®ä¾‹å±æ€§ï¼Œè®²åˆ°è¿™é‡Œå¿…é¡»è¦å¯¹<code>FiberNode</code>è¿›è¡Œä¸€äº›è¯´æ˜ï¼š</p><p><code>Fiber</code>æ˜¯<code>VDOM</code>æ˜¯åœ¨Reactæºç ä¸­çš„å®ç°ï¼Œ<code>FiberNode</code>å³è™šæ‹Ÿdomï¼Œåœ¨Vueæºç ä¸­å®šä¹‰ä¸º<code>VNode</code>ã€‚</p><p>åœ¨Reactæºç ä¸­æœ‰ä¸¤ç§<code>Fiber</code>èŠ‚ç‚¹å®šä¹‰ï¼š<code>FiberRootNode</code>å’Œ<code>FiberNode</code>ï¼Œä½†å®é™…ä¸Šæˆ‘ä»¬è¯´çš„<code>Fiber</code>èŠ‚ç‚¹æ˜¯æŒ‡çš„æ™®é€šçš„<code>FiberNode</code>ï¼Œæˆ‘ä»¬ä»ä¸Šé¢ä¸¤ä¸ªæ„é€ å‡½æ•°çš„å®šä¹‰å¯ä»¥å‘ç°ï¼Œå®ƒä»¬çš„å®ä¾‹å±æ€§å®Œå…¨ä¸åŒï¼Œå› ä¸ºå®ƒä»¬æœ¬æ¥å°±æ˜¯ä¸ä¸€æ ·çš„ä½œç”¨ã€‚</p><ul><li><code>FiberRootNode</code>ï¼šæ˜¯é’ˆå¯¹Reactåº”ç”¨æŒ‚è½½çš„å®¹å™¨å…ƒç´ ã€<code>#root</code>ã€‘åˆ›å»ºçš„ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒæ˜¯åº”ç”¨æ ¹èŠ‚ç‚¹ã€‚å®ƒçš„ä½œç”¨æ˜¯è´Ÿè´£åº”ç”¨åŠ è½½ç›¸å…³çš„å†…å®¹ã€åº”ç”¨çº§ã€‘ï¼Œæ¯”å¦‚åº”ç”¨åŠ è½½æ¨¡å¼<code>mode</code>ï¼Œå­˜å‚¨æœ¬æ¬¡åº”ç”¨æ›´æ–°çš„å›è°ƒä»»åŠ¡ä»¥åŠä¼˜å…ˆçº§ï¼Œå­˜å‚¨åˆ›å»ºå®Œæˆçš„<code>FiberTree</code>ç­‰ã€‚</li><li><code>FiberNode</code>ï¼šè¿™æ‰æ˜¯é’ˆå¯¹æ™®é€šDOMå…ƒç´ æˆ–è€…ç»„ä»¶åˆ›å»ºçš„<code>Fiber</code>å¯¹è±¡ï¼Œæ˜¯è™šæ‹ŸDOMçš„çœŸå®ä½“ç°ï¼Œå®ƒçš„å±æ€§å­˜å‚¨äº†å…ƒç´ çš„æˆ–è€…ç»„ä»¶çš„ç±»å‹ï¼Œå¯¹åº”çš„DOMä¿¡æ¯ï¼Œä»¥åŠæ•°æ®<code>State</code>å’Œç»„ä»¶æ›´æ–°çš„ç›¸å…³ä¿¡æ¯ï¼Œæ‰€ä»¥<code>FiberNode</code>æ‰æ˜¯<code>Fiber</code>æ¶æ„çš„æ ¸å¿ƒã€‚</li></ul><p>å›åˆ°<code>createContainer</code>æ–¹æ³•å†…ï¼š</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> uninitializedFiber</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createHostRootFiber</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span></code></pre></div><p>è¿™é‡Œè¦æ³¨æ„åˆ›å»ºçš„å¯¹è±¡ä¸º<code>HostFiber</code>ï¼Œè™½ç„¶å®ƒä¹Ÿæ˜¯æ™®é€šçš„<code>FiberNode</code>ç±»å‹ï¼Œä½†æ˜¯å®ƒçš„<code>tag</code>å±æ€§ä¸º<code>3</code>ï¼Œä»£è¡¨ç€å®ƒæ˜¯<strong>è™šæ‹ŸDOMæ ‘çš„æ ¹èŠ‚ç‚¹</strong>ã€‚æˆ‘ä»¬åç»­çš„æ›´æ–°ä¼šä»è¿™ä¸ªèŠ‚ç‚¹å¼€å§‹ä¸€æ­¥æ­¥å¾€ä¸‹éå†ã€‚</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> HostRoot</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><p><img src="/react-docs/assets/image-20241112202014424.CQC9kxCy.png" alt="image-20241112202014424"></p><p>ç„¶åå°†<code>FiberRootNode</code>ä¸<code>HostRootFiber</code>è¿›è¡Œå…³è”ï¼Œæ–¹ä¾¿åœ¨åç»­ä½¿ç”¨ä¸­å¯ä»¥äº’ç›¸è®¿é—®ï¼š</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">root.current </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> uninitializedFiber;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">uninitializedFiber.stateNode </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> root;</span></span></code></pre></div><p>ä»¥ä¸€å¼ å›¾è¡¨ç¤ºå®ƒä»¬çš„å…³ç³»ï¼š</p><p><img src="/react-docs/assets/image-20241112202030625.ewmwjrzY.png" alt="image-20241112202030625"></p><p><code>FiberRootNode</code>æ˜¯Reactåº”ç”¨çš„æ ¹èŠ‚ç‚¹ã€å®¹å™¨ã€‘ï¼Œ<code>HostRootFiber</code>æ˜¯è™šæ‹ŸDOMæ ‘çš„æ ¹èŠ‚ç‚¹ã€<code>FiberTree</code>ã€‘ã€‚</p><p>é€šè¿‡å±æ€§å…³è”ä¹‹åï¼Œå®ƒä»¬å°±å¯ä»¥åœ¨éœ€è¦çš„æ—¶å€™äº’ç›¸è®¿é—®ã€‚ä¾‹å¦‚æ›´æ–°çš„æ—¶å€™å¯ä»¥é€šè¿‡<code>FiberRootNode.current</code>æ‰¾åˆ°æˆ‘ä»¬çš„<code>fiber</code>æ ¹ç»“ç‚¹ã€‚</p><p>å›åˆ°<code>createContainer</code>æ–¹æ³•å†…ï¼š</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createContainer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  ...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">çœç•¥</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // åˆå§‹åŒ–HostFiberèŠ‚ç‚¹çš„updateQueueå±æ€§</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  initializeUpdateQueue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(uninitializedFiber);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // è¿”å›rootåº”ç”¨æ ¹èŠ‚ç‚¹å¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> root;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>å†è¿”å›<code>root</code>å¯¹è±¡ä¹‹å‰ï¼Œè¿˜éœ€è¦å¯¹<code>HostRootFiber</code>è¿›è¡Œå¤„ç†ï¼š</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// åˆå§‹åŒ–ä¸€ä¸ªFiberå¯¹è±¡çš„updateQueueå±æ€§</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> initializeUpdateQueue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">State</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">fiber</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Fiber</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // åˆ›å»ºä¸€ä¸ªæ›´æ–°é˜Ÿåˆ—å¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> queue</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> UpdateQueue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">State</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    baseState: fiber.memoizedState, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// åˆå§‹stateæ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    firstBaseUpdate: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    lastBaseUpdate: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    shared: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      pending: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      lanes: NoLanes,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    effects: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // è®¾ç½®æ›´æ–°é˜Ÿåˆ—å¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  fiber.updateQueue </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> queue;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>åˆå§‹åŒ–<code>HostFiber</code>èŠ‚ç‚¹çš„<code>updateQueue</code>å±æ€§ï¼Œä¸ºä¸€ä¸ªæ›´æ–°é˜Ÿåˆ—å¯¹è±¡ã€‚é‡Œé¢ä¼šå­˜å‚¨æˆ‘ä»¬çš„æ›´æ–°é“¾è¡¨ã€‚åç»­ä¼šè¯¦ç»†è®²è§£è¿™ä¸ªå±æ€§ã€‚</p><p><strong>æ€»ç»“<code>createContainer</code>æ–¹æ³•ï¼š</strong></p><ul><li>åˆ›å»º<code>FiberRootNode</code>åº”ç”¨æ ¹èŠ‚ç‚¹å¯¹è±¡ã€‚</li><li>åˆ›å»º<code>HostFiber</code>è™šæ‹ŸDOMæ ‘æ ¹èŠ‚ç‚¹å¯¹è±¡ã€‚</li><li>å…³è”ä¸¤ä¸ªå¯¹è±¡ï¼Œå¯ä»¥äº’ç›¸è®¿é—®ã€‚</li><li>åˆå§‹åŒ–<code>HostFiber</code>çš„<code>memoizedState</code>å±æ€§</li><li>åˆå§‹åŒ–<code>HostFiber</code>çš„<code>updateQueue</code>å±æ€§ã€‚</li><li>è¿”å›<code>FiberRootNode</code>èŠ‚ç‚¹ã€‚</li></ul><h4 id="markcontainerasroot" tabindex="-1">markContainerAsRoot <a class="header-anchor" href="#markcontainerasroot" aria-label="Permalink to &quot;markContainerAsRoot&quot;">â€‹</a></h4><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> markContainerAsRoot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">hostRoot</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Fiber</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">node</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Container</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  node[internalContainerInstanceKey] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> hostRoot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>è¿™é‡Œæä¸€ä¸‹è¿™ä¸ªå‡½æ•°ï¼Œä»–ä¿å­˜çš„æˆ‘ä»¬æ ¹<code>dom</code>èŠ‚ç‚¹å’Œ<code>HostFiber</code>çš„ä¸€ä¸ªå¼•ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ ¹ç»“ç‚¹çš„<code>internalContainerInstanceKey</code>æ‰¾åˆ°<code>HostFiber</code>ã€‚è¿™å¯¹æˆ‘ä»¬é¡¹ç›®å¼€å‘è°ƒè¯•ä¸­å¯ä»¥éšæ—¶æŸ¥çœ‹<code>fiber</code>ç»“æ„ã€‚æˆ‘ä»¬å¸¸ç”¨çš„å¼•ç”¨æœ‰ä¸‹é¢è¿™äº›</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> internalInstanceKey</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;__reactFiber$&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> randomKey; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// domè·å–fiber</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> internalPropsKey</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;__reactProps$&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> randomKey; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// domè·å–props</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> internalContainerInstanceKey</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;__reactContainer$&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> randomKey; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// domè·å–HostFiber</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> internalEventHandlersKey</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;__reactEvents$&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> randomKey; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è·å–evnets</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> internalEventHandlerListenersKey</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;__reactListeners$&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> randomKey;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> internalEventHandlesSetKey</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;__reactHandles$&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> randomKey;</span></span></code></pre></div><p>ä¾‹å¦‚ä¸‹é¢æˆ‘ä»¬å°±å¯ä»¥è®¿é—®å½“å‰çš„<code>fiber</code>äº†ã€‚</p><p><img src="/react-docs/assets/image-20241112204254506.CTNkhFiB.png" alt="image-20241112204254506"></p><h4 id="listentoallsupportedevents" tabindex="-1">listenToAllSupportedEvents <a class="header-anchor" href="#listentoallsupportedevents" aria-label="Permalink to &quot;listenToAllSupportedEvents&quot;">â€‹</a></h4><p>å›åˆ°<code>createRoot</code>æ–¹æ³•ï¼Œåœ¨åˆ›å»º<code>FiberRootNode</code>åº”ç”¨æ ¹èŠ‚ç‚¹å¯¹è±¡åï¼Œç„¶åç»™<code>#root</code>æ ¹å…ƒç´ ç»‘å®šäº†<strong>æ‰€æœ‰äº‹ä»¶</strong>ï¼Œä»»ä½•å­å­™å…ƒç´ è§¦å‘çš„è¯¥ç±»å‹äº‹ä»¶éƒ½ä¼šå§”æ‰˜ç»™ã€<strong>æ ¹å…ƒç´ çš„äº‹ä»¶å›è°ƒ</strong>ã€‘å¤„ç†ã€‚</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">listenToAllSupportedEvents</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(rootContainerElement);</span></span></code></pre></div><p>è¿™é‡Œæ¶‰åŠåˆ°äº†Reactçš„åˆæˆäº‹ä»¶ç³»ç»Ÿï¼Œå®ƒçš„å®ç°éå¸¸å¤æ‚ï¼Œåé¢ä¼šä»”ç»†è®²è§£è¿™éƒ¨åˆ†çš„å†…å®¹ã€‚æˆ‘ä»¬å¯ä»¥å¤§æ¦‚çœ‹ä¸‹è¿™é‡Œé¢åšçš„äº‹æƒ…ã€‚</p><ul><li>åœ¨<code>#root</code>æ ¹å…ƒç´ ä¸Šç»‘å®šæ‰€æœ‰çš„äº‹ä»¶å›è°ƒï¼Œä»»ä½•å­å­™å…ƒç´ è§¦å‘çš„æ”¹ç±»å‹äº‹ä»¶éƒ½ä¼šé€šè¿‡å†’æ³¡å§”æ‰˜ç»™ã€æ ¹å…ƒç´ çš„äº‹ä»¶å›è°ƒã€‘å¤„ç†ã€‚</li><li>é€šè¿‡è§¦å‘äº‹ä»¶çš„<code>dom</code>èŠ‚ç‚¹çš„<code>internalInstanceKey</code>ï¼Œæ‰¾åˆ°å¯¹åº”çš„<code>FiberNode</code>èŠ‚ç‚¹ã€‚</li><li>æ”¶é›†ä»å½“å‰<code>FiberNode</code>èŠ‚ç‚¹åˆ°<code>HostFiber</code>ä¹‹é—´çš„æ‰€æœ‰æ³¨å†Œè¯¥äº‹ä»¶çš„å›è°ƒå‡½æ•°ã€‚</li><li>å¾ªç¯æ‰§è¡Œä¸€æ¬¡æ”¶é›†çš„æ‰€æœ‰å›è°ƒå‡½æ•°ã€‚</li></ul><p>å›åˆ°<code>createRoot</code>æ–¹æ³•æœ€åï¼Œåˆ›å»ºäº†ä¸€ä¸ª<code>ReactDOMRoot</code>å®ä¾‹å¯¹è±¡å¹¶è¿”å›ã€‚</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ReactDOMRoot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(root);</span></span></code></pre></div><p>æŸ¥çœ‹<code>ReactDOMRoot</code>æ„é€ å‡½æ•°çš„å®šä¹‰ï¼š</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ReactDOMRoot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">internalRoot</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> FiberRoot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // å­˜å‚¨åº”ç”¨æ ¹èŠ‚ç‚¹[FiberRootNode]</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">._internalRoot </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> internalRoot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// åŸå‹æ–¹æ³•</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ReactDOMRoot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">prototype</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">render</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {}</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ReactDOMRoot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">prototype</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">unmount</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {}</span></span></code></pre></div><p><code>ReactDOMRoot</code>æ„é€ å‡½æ•°åªå®šä¹‰äº†ä¸€ä¸ªå®ä¾‹å±æ€§<code>_internalRoot</code>ï¼Œå®ƒçš„ä½œç”¨æ˜¯å­˜å‚¨åˆ›å»ºå®Œæˆçš„åº”ç”¨æ ¹èŠ‚ç‚¹<code>FiberRootNode</code>å¯¹è±¡ã€‚åé¢æˆ‘ä»¬è°ƒç”¨<code>render</code>çš„æ—¶å€™å¯ä»¥é€šè¿‡<code>this._internalRoot</code>æ‹¿åˆ°åº”ç”¨æ ¹ç»“ç‚¹</p><p>è¿˜åœ¨åŸå‹å¯¹è±¡ä¸Šå®šä¹‰äº†ä¸¤ä¸ªé™æ€æ–¹æ³•<code>render</code>å’Œ<code>unmount</code>ã€‚</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> React </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;react&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ReactDOM </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;react-dom/client&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> root</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ReactDOM.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createRoot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(document.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getElementById</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;root&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">));</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è°ƒç”¨renderæ–¹æ³•ï¼Œå¼€å§‹åº”ç”¨åŠ è½½</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">root.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">render</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">App</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /&gt;);</span></span></code></pre></div><p><strong>æœ€åå¯¹<code>createRoot</code>æ–¹æ³•åšä¸€ä¸ªæ€»ç»“ï¼š</strong> å®ƒçš„ä¸»è¦ä½œç”¨å°±æ˜¯ä¸ºreactåº”ç”¨åŠ è½½åšå‡†å¤‡å·¥ä½œï¼Œåˆå§‹åŒ–äº†ä¸€äº›æ ¹å¯¹è±¡å’ŒåŸºç¡€ä¿¡æ¯ï¼Œæœ€åè¿”å›äº†ä¸€ä¸ª<code>ReactDOMRoot</code>å¯¹è±¡ï¼Œè°ƒç”¨å®ƒçš„<code>render</code>æ–¹æ³•å¼€å¯<code>React</code>åº”ç”¨çš„åŠ è½½æµç¨‹ã€‚</p><h3 id="reactdomroot-prototype-render" tabindex="-1">ReactDOMRoot.prototype.render <a class="header-anchor" href="#reactdomroot-prototype-render" aria-label="Permalink to &quot;ReactDOMRoot.prototype.render&quot;">â€‹</a></h3><p>æœ€åæˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹è¿™ä¸ª<code>render</code>æ–¹æ³•ï¼š</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ReactDOMRoot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">prototype</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">render</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">children</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> root</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">._internalRoot; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ‹¿åˆ°FiberRootNode</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (root </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    throw</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Cannot update an unmounted root.&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // å¼€å§‹åŠ è½½reactåº”ç”¨ childrenä¸ºAppæ ¹ç»„ä»¶, rootä¸ºåº”ç”¨æ ¹èŠ‚ç‚¹å¯¹è±¡FiberRootNode</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   * reactç»„ä»¶éƒ½ä¼šè¢«è½¬æ¢ä¸ºreact-elementå¯¹è±¡:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   * {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   *    $$typeof: Symbol(react.element),</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   *    key: null,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   *    props: {},</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   *    ref: null,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   *    type: fun App() {}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   * }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   * </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   */</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  updateContainer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(children, root, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h4 id="updatecontainer" tabindex="-1">updateContainer <a class="header-anchor" href="#updatecontainer" aria-label="Permalink to &quot;updateContainer&quot;">â€‹</a></h4><p>ç»§ç»­æŸ¥çœ‹<code>updateContainer</code>æºç ï¼š</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// packages\react-reconciler\src\ReactFiberReconciler.new.js</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// åŠ è½½åº”ç”¨ï¼šè§¦å‘è°ƒåº¦æ›´æ–°ä»»åŠ¡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> updateContainer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  element</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ReactNodeList</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Appæ ¹ç»„ä»¶</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  container</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> OpaqueRoot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  parentComponent</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ?</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">React$Component</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">any</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">any</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  callback</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ?</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Lane</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // å–å‡ºcurrentå¯¹è±¡,ä¸ºHostFiber ã€å®ƒæ˜¯å½“å‰Fiberæ ‘çš„æ ¹èŠ‚ç‚¹ã€‘</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> current</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> container.current;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // è·å–å½“å‰çš„ç¨‹åºæ‰§è¡Œæ—¶é—´ã€é»˜è®¤æ˜¯performenct.nowè¿”å›çš„å¾®ç§’æ—¶é—´ã€‘</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> eventTime</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> requestEventTime</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  # è·å–æ›´æ–°ä¼˜å…ˆçº§lane</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> lane</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> requestUpdateLane</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(current);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // è·å–çˆ¶ç»„ä»¶çš„ä¸Šä¸‹æ–‡,å› ä¸ºparentComponentä¸ºnull,æ‰€ä»¥è¿™é‡Œcontextä¸ºç©ºå¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> context</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getContextForSubtree</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(parentComponent);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (container.context </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ä»nullå˜ä¸º{}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // å¦‚æœå®¹å™¨çš„ä¸Šä¸‹æ–‡ä¸ºnullï¼Œ åˆ™æŠŠçˆ¶çº§ä¸Šä¸‹æ–‡èµ‹å€¼</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    container.context </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> context;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // å¦‚æœå®¹å™¨å­˜åœ¨ä¸Šä¸‹æ–‡ï¼Œåˆ™æŠŠçˆ¶çº§çš„ä¸Šä¸‹æ–‡è®¾ç½®ä¸ºç­‰å¾…å¤„ç†çš„ä¸Šä¸‹æ–‡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    container.pendingContext </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> context;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  # åˆ›å»ºä¸€ä¸ªupdateæ›´æ–°å¯¹è±¡ </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> update</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createUpdate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(eventTime, lane);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // å°†æ›´æ–°å¯¹è±¡çš„ payload å±æ€§è®¾ç½®ä¸ºAppæ ¹ç»„ä»¶çš„å†…å®¹ï¼Œã€å³ï¼šæœ¬æ¬¡åº”ç”¨åŠ è½½çš„å†…å®¹ä¸ºAppæ ¹ç»„ä»¶ã€‘</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  update.payload </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {element};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // æœ¬æ¥å°±æ²¡æœ‰ï¼Œè®¾ç½®å®Œè¿˜æ˜¯null</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  callback </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> callback </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> undefined</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ?</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> :</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> callback;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // æ£€æŸ¥å›è°ƒå‡½æ•° callback æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ä¸ºç©ºï¼Œåˆ™å°†å…¶æ·»åŠ åˆ°æ›´æ–°å¯¹è±¡çš„ callback å±æ€§ä¸­</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (callback </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    update.callback </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> callback;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  # å°†æ›´æ–°å¯¹è±¡updateï¼šæ·»åŠ åˆ°å½“å‰currentå¯¹è±¡çš„æ›´æ–°é˜Ÿåˆ—ä¸­</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> root</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> enqueueUpdate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(current, update, lane);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (root </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    # å¼€å¯ä¸€ä¸ªæ–°çš„è°ƒåº¦æ›´æ–°ä»»åŠ¡</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    scheduleUpdateOnFiber</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(root, current, lane, eventTime);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    entangleTransitions</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(root, current, lane);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> lane;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><code>updateContainer</code>æ–¹æ³•çš„å†…å®¹éå¸¸é‡è¦ï¼Œä¸»è¦æ˜¯æ¯”è¾ƒ<strong>å…¸å‹</strong>ã€‚ä½ å¯ä»¥åœ¨reactæºç ä¸­çš„å¾ˆå¤šåœ°æ–¹çœ‹åˆ°ç±»ä¼¼çš„æ‰§è¡Œé€»è¾‘ï¼Œreactåº”ç”¨çš„åŠ è½½ä¼šæ‰§è¡Œè¿™äº›é€»è¾‘ï¼Œä¸€ä¸ª<code>state</code>çŠ¶æ€çš„å˜åŒ–ï¼Œè§¦å‘çš„æ›´æ–°ä¹Ÿä¼šæ‰§è¡Œè¿™äº›é€»è¾‘ã€‚æˆ‘ä»¬å¯ä»¥æŠŠå®ƒçš„æ‰§è¡Œè¿‡ç¨‹åˆ†ä¸ºå››ä¸ªé‡ç‚¹éƒ¨åˆ†ï¼š</p><ul><li>è·å–æ›´æ–°ä¼˜å…ˆçº§<code>lane</code>ï¼Œä¹Ÿå°±æ˜¯ç”Ÿæˆä¸€ä¸ªæœ¬æ¬¡æ›´æ–°å¯¹åº”çš„<code>lane</code>ã€‚</li><li>åˆ›å»º<code>update</code>æ›´æ–°å¯¹è±¡ ã€‚</li><li>å°†<code>update</code>æ›´æ–°å¯¹è±¡æ·»åŠ åˆ°ç›®æ ‡<code>Fiber</code>å¯¹è±¡çš„æ›´æ–°é˜Ÿåˆ—ä¸­ã€‚</li><li>è°ƒç”¨<code>scheduleUpdateOnFiber</code>å¼€å¯ä¸€ä¸ªæ–°çš„è°ƒåº¦æ›´æ–°ä»»åŠ¡ã€‚</li></ul><p>æ¥ä¸‹æ¥æˆ‘ä»¬é€ä¸ªåˆ†ææ‰§è¡Œè¿‡ç¨‹ï¼š</p><h5 id="ä¸€-è·å–æ›´æ–°ä¼˜å…ˆçº§lane" tabindex="-1"><strong>ï¼ˆä¸€ï¼‰è·å–æ›´æ–°ä¼˜å…ˆçº§lane</strong> <a class="header-anchor" href="#ä¸€-è·å–æ›´æ–°ä¼˜å…ˆçº§lane" aria-label="Permalink to &quot;**ï¼ˆä¸€ï¼‰è·å–æ›´æ–°ä¼˜å…ˆçº§lane**&quot;">â€‹</a></h5><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> lane</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> requestUpdateLane</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(current); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// HostFiber</span></span></code></pre></div><p>æŸ¥çœ‹<code>requestUpdateLane</code>æ–¹æ³•ï¼š</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// packages\react-reconciler\src\ReactFiberWorkLoop.new.js</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"># è·å–æ›´æ–°ä¼˜å…ˆçº§lane</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> requestUpdateLane</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">fiber</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Fiber</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Lane</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> mode</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fiber.mode;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ((mode </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ConcurrentMode) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> NoMode) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 1ï¼Œæ¨¡å¼ä¸º0æ—¶ï¼Œè¿”å›åŒæ­¥ä¼˜å…ˆçº§</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">SyncLane</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Lane</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  } else if (</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    !</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">deferRenderPhaseUpdateToNextBatch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp;&amp;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">executionContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp; </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">RenderContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) !== NoContext &amp;&amp;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    workInProgressRootRenderLanes !== NoLanes</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 2ï¼Œrenderé˜¶æ®µäº§ç”Ÿçš„updateã€æ¯”å¦‚è°ƒç”¨fun()ç»„ä»¶çš„è¿‡ç¨‹ä¸­åˆè§¦å‘äº†æ›´æ–°ã€‘ï¼Œè¿”å›renderé˜¶æ®µè¿›è¡Œä¸­æœ€é«˜çš„ä¼˜å…ˆçº§</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    return </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pickArbitraryLane</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">workInProgressRootRenderLanes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> isTransition</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> requestCurrentTransition</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!==</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> NoTransition;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 3ï¼ŒTransitionç›¸å…³ä¼˜å…ˆçº§ï¼šå¦‚æœå½“å‰ä¸æ˜¯æ¸²æŸ“ä¸Šä¸‹æ–‡ï¼Œå¹¶ä¸”è¯·æ±‚çš„æ›´æ–°æ˜¯è¿‡æ¸¡ï¼ˆtransitionï¼‰ï¼Œåˆ™è¿›å…¥ä¸‹ä¸€ä¸ªæ¡ä»¶ã€‚</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (isTransition) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      transition._updatedFibers.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(fiber);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (currentEventTransitionLane </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> NoLane) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      currentEventTransitionLane </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> claimNextTransitionLane</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> currentEventTransitionLane;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 4ï¼Œä½¿ç”¨æ‰‹åŠ¨è®¾ç½®çš„ä¼˜å…ˆçº§ï¼šè·å–å½“å‰æ›´æ–°é€šé“ä¼˜å…ˆçº§ ï¼šé»˜è®¤ä¸º0</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> updateLane</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Lane</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getCurrentUpdatePriority</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(): any);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // NoLane 0</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (updateLane </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!==</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> NoLane) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // åªè¦æ›´æ–°é€šé“ä¸ç­‰äº0ï¼Œåˆ™è¿”å›æœ‰æ•ˆçš„æ›´æ–°é€šé“</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> updateLane;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 5ï¼Œè·å–å½“å‰äº‹ä»¶çº§çš„ä¼˜å…ˆçº§ï¼š é»˜è®¤ä¸º16</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> eventLane</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Lane</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getCurrentEventPriority</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(): any);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> eventLane;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>åœ¨reactä¸­ï¼Œä¸ºäº†å®ç°å¹¶å‘æ¸²æŸ“å’Œä¼˜å…ˆçº§æ§åˆ¶ï¼Œä½¿ç”¨äº†å¤šä¸ªæ›´æ–°é€šé“ï¼ˆ<code>lane</code>ï¼‰æ¥ç®¡ç†æ›´æ–°ä»»åŠ¡ã€‚æ¯ä¸ªæ›´æ–°é€šé“éƒ½å¯¹åº”ä¸€ä¸ªä¼˜å…ˆçº§ï¼Œæ ¹æ®ä¸åŒçš„ä¼˜å…ˆçº§ï¼Œreactå¯ä»¥å†³å®šå“ªäº›æ›´æ–°ä»»åŠ¡å¯ä»¥åŒæ—¶è¿›è¡Œï¼Œå“ªäº›éœ€è¦ç­‰å¾…ä¹‹å‰çš„æ›´æ–°ä»»åŠ¡å®Œæˆåæ‰èƒ½è¿›è¡Œã€‚</p><p><code>requestUpdateLane</code>å‡½æ•°çš„ä½œç”¨æ˜¯ï¼šæ¥æ”¶ä¸€ä¸ª<code>Fiber</code>å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°çš„æ›´æ–°é€šé“ã€æ›´æ–°ä¼˜å…ˆçº§ã€‘ï¼Œè¿™ä¸ªä¼˜å…ˆçº§<code>lane</code>ä¼šæ ¹æ®å½“å‰<code>Fiber</code>å¯¹è±¡çš„ç›¸å…³å±æ€§æˆ–è€…å½“å‰çš„æ›´æ–°ç¯å¢ƒç¡®å®šçš„ã€‚</p><p><code>requestUpdateLane</code>æ–¹æ³•å†…æœ‰ä»¥ä¸‹äº”ç§æƒ…å†µå¯¹åº”çš„ä¼˜å…ˆçº§<code>lane</code>ï¼š</p><ol><li>åˆ¤æ–­å½“å‰æ˜¯å¦ä¸ºå¹¶å‘æ¸²æŸ“æ¨¡å¼ï¼Œå¦‚æœä¸æ˜¯åˆ™è¿”å›<code>syncLane</code>åŒæ­¥ä¼˜å…ˆçº§ã€‚</li><li>åˆ¤æ–­å½“å‰æ˜¯å¦ä¸º<code>render</code>ä¸­çš„æ›´æ–°ï¼Œå³åœ¨ç»„ä»¶æ¸²æŸ“ä¸­ä¿®æ”¹äº†çŠ¶æ€ï¼Œåˆè§¦å‘äº†æ›´æ–°ã€‚å¦‚æœæ˜¯åˆ™ä¼šä»å½“å‰<code>workInProgressRootRenderLanes</code>ä¸­é€‰æ‹©æœ€é«˜ä¼˜å…ˆçº§çš„<code>Lane</code>ï¼Œä½œä¸ºæœ¬æ¬¡æ›´æ–°çš„ä¼˜å…ˆçº§ã€‚</li><li>åˆ¤æ–­å½“å‰æ˜¯å¦ä¸º<code>useTransition hook</code>ç›¸å…³çš„æ›´æ–°ï¼Œå¦‚æœæ˜¯åˆ™åœ¨æ­¤è®¡ç®—å¯¹åº”çš„ä¼˜å…ˆçº§<code>lane</code>ï¼Œå¹¶è®¾ç½®ä¸ºå½“å‰çš„æ›´æ–°ä¼˜å…ˆçº§ã€‚</li><li>åˆ¤æ–­æ˜¯å¦å­˜åœ¨è°ƒåº¦ä¸­çš„æ›´æ–°ä¼˜å…ˆçº§ï¼Œå¦‚æœå­˜åœ¨åˆ™ä½¿ç”¨æ­¤ä¼˜å…ˆçº§<code>lane</code>ã€‚</li><li>åœ¨ä»¥ä¸Šæƒ…å†µéƒ½ä¸æ»¡è¶³æ—¶ï¼Œå°±ä¼šä»äº‹ä»¶ä¸­æ¥å¯»æ‰¾å¯¹åº”çš„ä¼˜å…ˆçº§ã€‚</li></ol><p>å½“å‰ä¸ºreactåº”ç”¨é¦–æ¬¡åŠ è½½ï¼Œæ‰€ä»¥ä¸æ»¡è¶³å‰é¢çš„æ¡ä»¶ï¼Œæœ€åå°±ä¼šè¿”å›<code>eventLane</code>ï¼Œä½œä¸ºæœ¬æ¬¡æ›´æ–°çš„ä¼˜å…ˆçº§<code>lane</code>ã€‚</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> eventLane</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getCurrentEventPriority</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getCurrentEventPriority</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> currentEvent</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> window.event;  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// åº”ç”¨é¦–æ¬¡åŠ è½½ï¼Œè¿™é‡Œä¸ºundefined</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (currentEvent </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> undefined</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    # è¿”å›é»˜è®¤äº‹ä»¶ä¼˜å…ˆçº§16</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DefaultEventPriority;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // è¿”å›äº‹ä»¶å¯¹åº”çš„ä¼˜å…ˆçº§</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getEventPriority</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(currentEvent.type);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>å› ä¸ºreactåº”ç”¨çš„é¦–æ¬¡åŠ è½½å¹¶ä¸æ˜¯ç”±æŸä¸ªå…·ä½“çš„äº‹ä»¶è§¦å‘çš„ï¼Œæ‰€ä»¥<code>window.event</code>çš„å€¼ä¸º<code>undefined</code>ï¼Œè¿™é‡Œå°±ä¼šè¿”å›<strong>é»˜è®¤çš„äº‹ä»¶ä¼˜å…ˆçº§lane</strong>æ¥ä½œä¸ºåº”ç”¨åˆå§‹åŠ è½½çš„ä¼˜å…ˆçº§ã€‚</p><h6 id="ä¼˜å…ˆçº§ä½“ç³»" tabindex="-1">ä¼˜å…ˆçº§ä½“ç³» <a class="header-anchor" href="#ä¼˜å…ˆçº§ä½“ç³»" aria-label="Permalink to &quot;ä¼˜å…ˆçº§ä½“ç³»&quot;">â€‹</a></h6><p>åœ¨reactæºç ä¸­ï¼Œ<code>Scheduler</code>è°ƒåº¦å™¨æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„åŒ…ï¼ŒReactä¸Scheduleræ²¡æœ‰å…±ç”¨ä¸€å¥—ä¼˜å…ˆçº§ä½“ç³»ï¼š</p><p>reactä¸­æœ‰å››ç§ä¼˜å…ˆçº§ï¼Œç§°ä¸ºäº‹ä»¶ä¼˜å…ˆçº§ï¼ŒScheduleræœ‰äº”ç§ä¼˜å…ˆçº§ï¼Œç§°ä¸ºè°ƒåº¦ä¼˜å…ˆçº§ã€‚</p><ul><li><code>react</code>çš„äº‹ä»¶ä¼˜å…ˆçº§ï¼š</li></ul><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 1ï¼Œå¯¹åº”ç¦»æ•£äº‹ä»¶çš„ä¼˜å…ˆçº§ï¼Œå°±æ˜¯æ™®é€šçš„äº‹ä»¶æ¯”å¦‚click,input,blurç­‰ï¼Œè¿™äº›äº‹ä»¶å¯¹åº”çš„æ˜¯åŒæ­¥ä¼˜å…ˆçº§</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> DiscreteEventPriority</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> EventPriority</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SyncLane;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 2ï¼Œå¯¹åº”çš„è¿ç»­äº‹ä»¶çš„ä¼˜å…ˆçº§ï¼Œæ¯”å¦‚drag,mousemove,scroll,wheelç­‰ï¼Œ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ContinuousEventPriority</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> EventPriority</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> InputContinuousLane;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 3ï¼Œé»˜è®¤çš„ä¼˜å…ˆçº§</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> DefaultEventPriority</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> EventPriority</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DefaultLane;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 4ï¼Œç©ºé—²æƒ…å†µçš„ä¼˜å…ˆçº§ï¼Œæœ€ä½</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> IdleEventPriority</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> EventPriority</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> IdleLane;</span></span></code></pre></div><ul><li><code>scheduler</code>çš„è°ƒåº¦ä¼˜å…ˆçº§ï¼š</li></ul><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å€¼è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ImmediatePriority</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æœ€é«˜ä¼˜å…ˆçº§ï¼ŒåŒæ­¥æ‰§è¡Œ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> UserBlockingPriority</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NormalPriority</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// é»˜è®¤ä¼˜å…ˆçº§</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> LowPriority</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> IdlePriority</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æœ€ä½ä¼˜å…ˆçº§</span></span></code></pre></div><p>Reactä¸Schedulerçš„ä¼˜å…ˆçº§è½¬æ¢éœ€è¦ï¼šé€šè¿‡<code>lane</code>è½¬åŒ–ã€‚</p><ul><li>ä»<code>React</code>åˆ°<code>Scheduler</code>çš„ä¼˜å…ˆçº§è½¬æ¢ï¼š</li></ul><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> eventLane</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> lanesToEventPriority</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(nextLanes)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> schedulerPriorityLevel; </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"># lanesè½¬æ¢æˆäº‹ä»¶ä¼˜å…ˆçº§ï¼ŒåŒ¹é…ç¬¦åˆçš„äº‹ä»¶ä¼˜å…ˆçº§ï¼Œç„¶åèµ‹å€¼å¯¹åº”çš„schedulerçš„ä¼˜å…ˆçº§</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">switch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (eventLane) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // åŒæ­¥ä¼˜å…ˆçº§</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  case</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DiscreteEventPriority:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    schedulerPriorityLevel </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ImmediateSchedulerPriority;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    break</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // è¿ç»­äº‹ä»¶ä¼˜å…ˆçº§</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  case</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ContinuousEventPriority:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    schedulerPriorityLevel </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> UserBlockingSchedulerPriority;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    break</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // é»˜è®¤äº‹ä»¶ä¼˜å…ˆçº§</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  case</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DefaultEventPriority:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    schedulerPriorityLevel </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> NormalSchedulerPriority;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    break</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ç©ºé—²äº‹ä»¶ä¼˜å…ˆçº§</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  case</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> IdleEventPriority:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    schedulerPriorityLevel </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> IdleSchedulerPriority;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    break</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // é»˜è®¤</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  default</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    schedulerPriorityLevel </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> NormalSchedulerPriority;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    break</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><ul><li>ä»<code>Scheduler</code>åˆ°<code>React</code>çš„ä¼˜å…ˆçº§è½¬æ¢ï¼š</li></ul><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è·å–å½“å‰è°ƒåº¦çš„ä¼˜å…ˆçº§ï¼Œç„¶åæ ¹æ®ä¼˜å…ˆçº§åŒ¹é…åˆ°å¯¹åº”çš„ä¼˜å…ˆçº§ï¼Œæœ€åè¿”å›å¯¹åº”çš„äº‹ä»¶ä¼˜å…ˆçº§</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> schedulerPriority</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getCurrentSchedulerPriorityLevel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	switch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (schedulerPriority) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    case</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ImmediateSchedulerPriority:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DiscreteEventPriority;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    case</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> UserBlockingSchedulerPriority:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ContinuousEventPriority;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    case</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> NormalSchedulerPriority:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    case</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> LowSchedulerPriority:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DefaultEventPriority;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    case</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> IdleSchedulerPriority:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> IdleEventPriority;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    default</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DefaultEventPriority;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>é™¤äº†äº‹ä»¶ä¼˜å…ˆçº§å’Œè°ƒåº¦ä¼˜å…ˆçº§ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜æœ‰<code>lane</code>ä¼˜å…ˆçº§ã€‚è¿™ä¸ªä¸»è¦åœ¨<code>fiber</code>ä¸­ä½¿ç”¨ã€‚åç»­æˆ‘ä»¬ä¼šå¯¹è¿™äº›ä¼˜å…ˆçº§åšä¸€ä¸ªç»Ÿä¸€çš„è®²è§£</p><h6 id="reactä¸­çš„ä½è¿ç®—" tabindex="-1">reactä¸­çš„ä½è¿ç®— <a class="header-anchor" href="#reactä¸­çš„ä½è¿ç®—" aria-label="Permalink to &quot;reactä¸­çš„ä½è¿ç®—&quot;">â€‹</a></h6><p>è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªæ³¨æ„ç‚¹ï¼š</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> requestUpdateLane</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">fiber</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Fiber</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Lane</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> mode</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fiber.mode;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ä½è¿ç®—</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ((mode </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ConcurrentMode) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> NoMode) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">SyncLane</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Lane</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  } </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>è¿™é‡Œç®—æ˜¯æˆ‘ä»¬åœ¨reactæºç ä¸­é‡åˆ°çš„ç¬¬ä¸€ä¸ªä½è¿ç®—å¤„ç†ï¼Œæ‰€ä»¥éœ€è¦æå‰è¯´æ˜ä¸€ä¸‹ã€‚å¦‚æœä½ é˜…è¯»è¿‡<code>react</code>æºç ï¼Œå°±å¯ä»¥å‘ç°å…¶å†…éƒ¨ä½¿ç”¨äº†å¤§é‡çš„ä½è¿ç®—æ“ä½œï¼Œå…¶ä¸­æœ€å…¸å‹çš„å°±æ˜¯<code>lanes</code>ä¼˜å…ˆçº§å’Œ<code>flags</code>å‰¯ä½œç”¨æ ‡è®°ã€‚</p><p>è¿™é‡Œåªä»‹ç»ä¸‰ç§åŸºæœ¬çš„ä½è¿ç®—ï¼Œå› ä¸ºreactæºç ä¸­ä¸»è¦ä½¿ç”¨çš„å°±æ˜¯ä¸‰ç§ï¼Œå…³äºä½è¿ç®—çš„æ›´å¤šä¿¡æ¯å¯ä»¥å‚è€ƒã€ŠJavaScripté«˜çº§ç¨‹åºè®¾è®¡4ã€‹ä¸­çš„ä½æ“ä½œç¬¦ç« èŠ‚ã€‚</p><ul><li>æŒ‰ä½ä¸<code>&amp;</code></li></ul><table tabindex="0"><thead><tr><th>ç¬¬ä¸€ä¸ªæ•°å€¼çš„ä½</th><th>ç¬¬äºŒä¸ªæ•°å€¼çš„ä½</th><th>ç»“ æœ</th></tr></thead><tbody><tr><td>1</td><td>1</td><td>1</td></tr><tr><td>1</td><td>0</td><td>0</td></tr><tr><td>0</td><td>1</td><td>0</td></tr><tr><td>0</td><td>0</td><td>0</td></tr></tbody></table><p>æŒ‰ä½ä¸æ“ä½œåœ¨ä¸¤ä¸ªä½éƒ½æ˜¯ 1 æ—¶è¿”å› 1ï¼Œ<strong>åœ¨ä»»ä½•ä¸€ä½æ˜¯ 0 æ—¶è¿”å› 0</strong>ã€‚</p><p>è¿™é‡Œç›´æ¥ä»¥ä¸Šé¢çš„ä»£ç ä¸ºä¾‹ï¼šæ­¤æ—¶<code>mode</code>ä¸º<code>3</code>ï¼Œ<code>ConcurrentMode</code>ä¸º<code>1</code>ï¼š</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span></span></code></pre></div><p>è®¡ç®—<code>3&amp;1</code>ï¼Œé¦–å…ˆå°†æ“ä½œæ•°è½¬åŒ–ä¸º<code>Int32</code>ï¼š</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 3</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0b00</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0011</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 1</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0b00</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0001</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// &amp;è®¡ç®—</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0b00</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0001</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // // ç»“æœ1</span></span></code></pre></div><p><code>3&amp;1</code>è®¡ç®—ç»“æœä¸º<code>1</code>ï¼Œä¸ç­‰äº<code>NoMode</code>ã€0ã€‘ï¼Œæ‰€ä»¥ä¸æ»¡è¶³æ¡ä»¶ã€‚</p><ul><li>æŒ‰ä½æˆ–<code>|</code></li></ul><table tabindex="0"><thead><tr><th>ç¬¬ä¸€ä¸ªæ•°å€¼çš„ä½</th><th>ç¬¬äºŒä¸ªæ•°å€¼çš„ä½</th><th>ç»“ æœ</th></tr></thead><tbody><tr><td>1</td><td>1</td><td>1</td></tr><tr><td>1</td><td>0</td><td>1</td></tr><tr><td>0</td><td>1</td><td>1</td></tr><tr><td>0</td><td>0</td><td>0</td></tr></tbody></table><p>æŒ‰ä½æˆ–æ“ä½œåœ¨è‡³å°‘ä¸€ä½æ˜¯ 1 æ—¶è¿”å› 1ï¼Œ<strong>ä¸¤ä½éƒ½æ˜¯ 0 æ—¶è¿”å› 0</strong>ã€‚</p><p>è®¡ç®—<code>3 | 1</code>ï¼š</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 3</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0b00</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0011</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 1</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0b00</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0001</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 3|1è®¡ç®—</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0b00</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0011</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // ç»“æœä¸º3</span></span></code></pre></div><ul><li>æŒ‰ä½é<code>~</code></li></ul><table tabindex="0"><thead><tr><th>ä¸€ä¸ªæ“ä½œæ•°çš„bitä½ï¼šå–å</th><th>ç»“æœ</th></tr></thead><tbody><tr><td>1</td><td>0</td></tr><tr><td>0</td><td>1</td></tr></tbody></table><p>æŒ‰ä½æˆ–æ“ä½œæ˜¯å¯¹ä¸€ä¸ªæ“ä½œæ•°è¿›è¡Œå–åæ“ä½œã€0ï¼Œ1äº’æ¢ã€‘ã€‚</p><p>è®¡ç®—<code>~3</code>ï¼š</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 3</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0b00</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0011</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ~3 é€ä½å–å</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0b11</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1111</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1111</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1111</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1111</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1111</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1111</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1100</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // ç»“æœä¸º-4</span></span></code></pre></div><h6 id="lanesè®¡ç®—" tabindex="-1">lanesè®¡ç®— <a class="header-anchor" href="#lanesè®¡ç®—" aria-label="Permalink to &quot;lanesè®¡ç®—&quot;">â€‹</a></h6><p>å¸¸è§çš„å‡ ä¸ªé€šè¿‡ä½è¿ç®—æ¥è®¡ç®—<code>lanes</code>çš„æ–¹æ³•ï¼š</p><ul><li>åˆå¹¶<code>lanes</code>ï¼š</li></ul><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// packages\react-reconciler\src\ReactFiberLane.new.js</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// åˆå¹¶lanes</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> mergeLanes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">a</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Lanes</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Lane</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">b</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Lanes</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Lane</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Lanes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> a </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> b;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><ul><li>ç§»é™¤<code>lanes</code>ï¼š</li></ul><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ç§»é™¤lanes</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> removeLanes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">set</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Lanes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">subset</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Lanes</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Lane</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Lanes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> set </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">subset;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><ul><li>æ˜¯å¦åŒ…å«<code>lanes</code>ï¼š</li></ul><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// åˆ¤æ–­å½“å‰çš„lanesæ˜¯å¦åŒ…å«æŸä¸ªlane</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> includesSomeLane</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">a</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Lanes</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Lane</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">b</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Lanes</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Lane</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (a </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> b) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!==</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> NoLanes;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h5 id="äºŒ-åˆ›å»ºupdateæ›´æ–°å¯¹è±¡" tabindex="-1"><strong>ï¼ˆäºŒï¼‰åˆ›å»ºupdateæ›´æ–°å¯¹è±¡</strong> <a class="header-anchor" href="#äºŒ-åˆ›å»ºupdateæ›´æ–°å¯¹è±¡" aria-label="Permalink to &quot;**ï¼ˆäºŒï¼‰åˆ›å»ºupdateæ›´æ–°å¯¹è±¡**&quot;">â€‹</a></h5><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> update</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createUpdate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(eventTime, lane);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// packages\react-reconciler\src\ReactFiberClassUpdateQueue.new.js</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"># åˆ›å»ºæ›´æ–°å¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createUpdate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">eventTime</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">lane</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Lane</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Update</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;*&gt; {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // å®šä¹‰updateå¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> update</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Update</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;*&gt; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    eventTime,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    lane, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ›´æ–°ä¼˜å…ˆçº§</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    tag: UpdateState,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ä¸åŒçš„tagå¯¹åº”ä¸åŒçš„æ›´æ–°åœºæ™¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    payload: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ›´æ–°çš„å†…å®¹   == funç»„ä»¶ç”¨actionå­—æ®µ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    callback: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å›è°ƒå‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    next: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// é“¾è¡¨å½¢å¼ï¼šæŒ‡å‘ä¸‹ä¸€ä¸ªæ›´æ–°çš„å¯¹è±¡ã€ä¿è¯äº†updateä¹‹é—´çš„é¡ºåºã€‘</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // è¿”å›åˆ›å»ºçš„updateå¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> update;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><code>update</code>å¯¹è±¡çš„å­˜å‚¨äº†æ›´æ–°ç›¸å…³çš„ä¸€äº›åŸºæœ¬ä¿¡æ¯ã€‚</p><ul><li><code>tag</code>å±æ€§ï¼šä¸åŒå€¼å¯¹åº”ç€ä¸åŒçš„æ›´æ–°åœºæ™¯ï¼š</li></ul><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 1ï¼Œé»˜è®¤æƒ…å†µï¼šé€šè¿‡ReactDOM.createRootæˆ–è€…this.setStateè§¦å‘</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> UpdateState</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 2ï¼Œåœ¨classCompontç»„ä»¶ç”Ÿå‘½å‘¨æœŸå‡½æ•°ä¸­ä½¿ç”¨this.setStateè§¦å‘æ›´æ–°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ReplaceState</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 3ï¼Œé€šè¿‡this.forceUpdateè§¦å‘</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ForceUpdate</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 4ï¼Œå‘ç”Ÿé”™è¯¯çš„æƒ…å†µä¸‹åœ¨classComponentæˆ–è€…HostRootä¸­è§¦å‘æ›´æ–°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> CaptureUpdate</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><p><img src="/react-docs/assets/image-20241112204925827.DTav4WPv.png" alt="image-20241112204925827"></p><p>å½“å‰æ˜¯é€šè¿‡<code>ReactDOM.createRoot</code>è§¦å‘çš„åº”ç”¨åŠ è½½ï¼Œæ‰€ä»¥<code>update</code>å¯¹è±¡çš„<code>tag</code>å±æ€§å€¼ä¸º<code>0</code>ã€‚</p><ul><li><code>payload</code>å±æ€§å€¼å¯¹åº”çš„æƒ…å†µï¼š</li></ul><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"># </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ï¼ŒReactDOM.reacteRoot</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    payload</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: { element } </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å³&lt;App /&gt;ç»„ä»¶å¯¹åº”çš„elementå¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"># </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ï¼ŒclassComponentç»„ä»¶</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// this.setState({ count: 1 })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    payload</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: { </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">count</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ä¹Ÿæœ‰å¯èƒ½æ˜¯ä¸€ä¸ªå‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>å½“å‰çš„<code>payload</code>å±æ€§å­˜å‚¨çš„æ˜¯<code>App</code>æ ¹ç»„ä»¶å¯¹åº”çš„<code>element</code>å¯¹è±¡ã€‚</p><img src="/react-docs/assets/image-20241112205052648.BeFZaUol.png" alt="image-20241112205052648" style="zoom:50%;"><ul><li><code>callback</code>å±æ€§ï¼šå½“å‰ä¸º<code>null</code>ã€‚å¦‚æœæ˜¯<code>this.setState</code>è§¦å‘çš„æ›´æ–°ï¼Œåˆ™ä¸ºæ­¤æ–¹æ³•ä¼ å…¥çš„ç¬¬äºŒä¸ªå‚æ•°ã€å›è°ƒå‡½æ•°ã€‘ã€‚</li><li><code>next</code>å±æ€§ï¼šæŒ‡å‘ä¸‹ä¸€ä¸ª<code>update</code>æ›´æ–°å¯¹è±¡ï¼Œå½¢æˆä¸€ä¸ªå•å‘ç¯çŠ¶é“¾è¡¨ã€‚</li></ul><p><strong>æ€»ç»“ï¼š</strong> æ ¹æ®ä¸Šé¢çš„<code>tag</code>å€¼ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºç±»ç»„ä»¶çš„æ›´æ–°ä¸<code>ReactDOM.createRoot</code>å…±ç”¨åŒä¸€ä¸ª<code>update</code>æ›´æ–°å¯¹è±¡ç»“æ„ï¼Œå¯¹äº<code>ReactDOM.createRoot</code>æ¥è¯´ï¼Œå½“å‰åˆ›å»ºçš„è¿™ä¸ª<code>update</code>å¯¹è±¡ï¼Œå®ƒçš„ä½œç”¨ä¸»è¦åœ¨äºåœ¨reactåº”ç”¨çš„é¦–æ¬¡åŠ è½½ã€æä¾›çš„åˆå§‹ä¿¡æ¯ã€‘ã€‚ä¸»è¦æ˜¯æˆ‘ä»¬ä¼ è¿›æ¥çš„ç»„ä»¶</p><h5 id="ä¸‰-å°†updateæ›´æ–°å¯¹è±¡æ·»åŠ åˆ°ç›®æ ‡fiberå¯¹è±¡çš„æ›´æ–°é˜Ÿåˆ—ä¸­" tabindex="-1"><strong>ï¼ˆä¸‰ï¼‰å°†updateæ›´æ–°å¯¹è±¡æ·»åŠ åˆ°ç›®æ ‡Fiberå¯¹è±¡çš„æ›´æ–°é˜Ÿåˆ—ä¸­</strong> <a class="header-anchor" href="#ä¸‰-å°†updateæ›´æ–°å¯¹è±¡æ·»åŠ åˆ°ç›®æ ‡fiberå¯¹è±¡çš„æ›´æ–°é˜Ÿåˆ—ä¸­" aria-label="Permalink to &quot;**ï¼ˆä¸‰ï¼‰å°†updateæ›´æ–°å¯¹è±¡æ·»åŠ åˆ°ç›®æ ‡Fiberå¯¹è±¡çš„æ›´æ–°é˜Ÿåˆ—ä¸­**&quot;">â€‹</a></h5><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> root</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> enqueueUpdate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(current, update, lane);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// packages\react-reconciler\src\ReactFiberClassUpdateQueue.new.js</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> enqueueUpdate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">State</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  fiber</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Fiber</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è¦æ›´æ–°çš„èŠ‚ç‚¹ ï¼Œå½“å‰ä¹Ÿå°±æ˜¯hostFiber</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  update</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Update</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">State</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ›´æ–°å¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  lane</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Lane</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ›´æ–°çš„ä¼˜å…ˆçº§</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> FiberRoot</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // å–å‡ºå½“å‰FiberèŠ‚ç‚¹çš„updateQueueå±æ€§</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> updateQueue</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fiber.updateQueue;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (updateQueue </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // è¡¨æ˜å½“å‰èŠ‚ç‚¹å·²ç»è¢«å¸è½½</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ä¸€ä¸ªFiberèŠ‚ç‚¹ä¼šå…ˆåˆå§‹åŒ–updateQueueå±æ€§ï¼Œååˆ›å»ºUpdateå¯¹è±¡</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // å–å‡ºupdateQueue.sharedå¯¹è±¡ { lanes: 0, pending: null }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sharedQueue</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> SharedQueue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">State</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">updateQueue</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> any</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).shared;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // åˆ¤æ–­å½“å‰æ˜¯å¦ä¸ºä¸å®‰å…¨çš„æ¸²æŸ“é˜¶æ®µæ›´æ–°ã€‚ä¸€èˆ¬classæ‰ä¼šèµ°åˆ°</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  if (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">isUnsafeClassRenderPhaseUpdate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">fiber</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    const pending </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sharedQueue.pending;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">pending</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> === </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      update.next </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> update;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    } else {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      update.next </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pending.next;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      pending.next </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> update;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    sharedQueue.pending </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> update;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    return </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">unsafe_markUpdateLaneFromFiberToRoot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">fiber</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">lane</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  } else {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // é»˜è®¤æ˜¯å¤„äºå®‰å…¨çš„æ¸²æŸ“é˜¶æ®µæ›´æ–°ï¼šå°†updateå¯¹è±¡æ·»åŠ åˆ°queueä¹‹ä¸­ã€‚</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    return </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">enqueueConcurrentClassUpdate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">fiber</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">sharedQueue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">update</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">lane</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> enqueueConcurrentClassUpdate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">State</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  fiber</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Fiber</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// fiebr</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  queue</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ClassQueue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">State</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// sharing</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  update</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ClassUpdate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">State</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å½“å‰æ›´æ–°</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  lane</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Lane</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> interleaved</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> queue.interleaved;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ç¬¬ä¸€æ¬¡æ›´æ–°ã€‚interleavedè¿˜ä¸ºç©º</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (interleaved </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) { </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// interleavedç”¨æ¥ä¸´æ—¶å­˜å‚¨ï¼Œåç»­ä¼šæ”¾åˆ°pendingå±æ€§ä¸­</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    update.next </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> update;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    pushConcurrentUpdateQueue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(queue);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    update.next </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> interleaved.next;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    interleaved.next </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> update;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  queue.interleaved </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> update; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ„æˆä¸€ä¸ªç¯å½¢é“¾è¡¨</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ä¸€ç›´å‘ä¸Šæ‰¾åˆ°æ ¹èŠ‚ç‚¹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> markUpdateLaneFromFiberToRoot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(fiber, lane); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è¿”å›çš„æ˜¯æ ¹èŠ‚ç‚¹çš„stateNodeï¼Œä¹Ÿå°±æ˜¯fiberRoot</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>å‰é¢æˆ‘ä»¬å·²ç»çŸ¥é“äº†<code>update</code>å¯¹è±¡æ˜¯å­˜å‚¨æ›´æ–°ç›¸å…³çš„ä¸€äº›åŸºæœ¬ä¿¡æ¯ï¼Œå¹¶ä¸”åœ¨<code>createContainer</code>ä¸­ä¹Ÿåˆå§‹åŒ–äº†è¿™ä¸ªå¯¹è±¡ã€‚å¯ä»¥è¯´å®ƒæ˜¯ä¸€ä¸ªåŸºæœ¬çš„æ›´æ–°è£…ç½®ï¼Œè€Œ<code>updateQueue</code>å¾ˆæ˜æ˜¾å°±æ˜¯æ¥ä¿å­˜æˆ–è€…è¯´ç®¡ç†<code>update</code>å¯¹è±¡çš„æ•°æ®ç»“æ„ã€‚</p><p>ç»è¿‡ä¸Šé¢çš„å¤„ç†ï¼Œæœ€ç»ˆä¼šå°†<code>update</code>æ›´æ–°å¯¹è±¡å­˜å‚¨åˆ°å½“å‰<code>Fiber</code>èŠ‚ç‚¹ä¸­ï¼Œå½¢æˆä¸€ä¸ª<strong>å•å‘ç¯çŠ¶é“¾è¡¨</strong>ã€‚è¿™é‡Œæè¿°çš„æ¯”è¾ƒç®€å•ï¼Œå› ä¸ºå¯¹äºreactåº”ç”¨åŠ è½½çš„åœºæ™¯ï¼Œ<code>update</code>å’Œ<code>updateQueue</code>çš„ä½œç”¨å¹¶ä¸æ˜æ˜¾ã€‚å®ƒä»¬æ›´é‡è¦çš„ä½¿ç”¨åœºæ™¯ï¼Œåœ¨äºç»„ä»¶æ›´æ–°æ—¶çš„é€»è¾‘å¤„ç†ã€‚åç»­æˆ‘ä»¬å¯ä»¥åœ¨å‡½æ•°ç»„ä»¶å’Œç±»ç»„ä»¶ä¸­è¯¦ç»†è®²è§£</p><h5 id="å››-å¼€å¯ä¸€ä¸ªæ–°çš„è°ƒåº¦æ›´æ–°ä»»åŠ¡" tabindex="-1"><strong>ï¼ˆå››ï¼‰å¼€å¯ä¸€ä¸ªæ–°çš„è°ƒåº¦æ›´æ–°ä»»åŠ¡</strong> <a class="header-anchor" href="#å››-å¼€å¯ä¸€ä¸ªæ–°çš„è°ƒåº¦æ›´æ–°ä»»åŠ¡" aria-label="Permalink to &quot;**ï¼ˆå››ï¼‰å¼€å¯ä¸€ä¸ªæ–°çš„è°ƒåº¦æ›´æ–°ä»»åŠ¡**&quot;">â€‹</a></h5><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å¼€å¯ä¸€ä¸ªæ–°çš„çš„è°ƒåº¦æ›´æ–°ä»»åŠ¡</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">scheduleUpdateOnFiber</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(root, current, lane, eventTime);</span></span></code></pre></div><p><code>scheduleUpdateOnFiber</code>å‡½æ•°éå¸¸é‡è¦ï¼Œåœ¨reactæºç ä¸­æœ‰å¾ˆå¤šåœ°æ–¹åœ¨è°ƒç”¨ï¼Œå®ƒæ˜¯reactå¼€å§‹æ‰§è¡Œè°ƒåº¦æ›´æ–°çš„å…¥å£å‡½æ•°ã€‚</p><p>ä»è¿™ä¸ªå‡½æ•°çš„åç§°æˆ‘ä»¬ä¹Ÿå¯ä»¥çŸ¥é“å®ƒçš„ä½œç”¨ï¼šå¼€å¯ä¸€ä¸ªæ–°çš„è°ƒåº¦æ›´æ–°ä»»åŠ¡ã€‚</p><p>åç»­æˆ‘ä»¬ä¼šæ‹†æˆä¸‰ä¸ªéƒ¨åˆ†æ¥æ¥è®²è§£æ¸²æŸ“æµç¨‹</p><ol><li>å‘èµ·è°ƒåº¦</li><li><code>render</code>é˜¶æ®µ ï¼ˆéå†<code>element</code>å¯¹è±¡ç”Ÿæˆ<code>fiber</code>èŠ‚ç‚¹ï¼‰</li><li><code>commit</code>é˜¶æ®µï¼ˆå°†<code>fiber</code>èŠ‚ç‚¹æäº¤åˆ°é¡µé¢ä¸Šï¼‰</li></ol></div></div></main><footer class="VPDocFooter" data-v-39a288b8 data-v-e257564d><!--[--><!--[--><!--[--><!--[--><div class="vp-doc" style="margin-bottom:64px;"><h2 id="å†™åœ¨æœ€å" tabindex="-1"> å†™åœ¨æœ€å <a class="header-anchor" href="#å†™åœ¨æœ€å" aria-label="Permalink to &quot;å†™åœ¨æœ€å&quot;">â€‹</a></h2> ç å­—ä¸æ˜“ï¼Œè¿˜è¯·å¤§å®¶ç‚¹å‡»å³ä¸Šè§’ä¸ºé¡¹ç›®å¤šå¤šstarï¼Œå¦‚æœè§‰å¾—æ–‡ç« è´¨é‡ä¸é”™çš„è¯ï¼Œå¯ä»¥è¯·ä½œè€…å–æ¯å’–å•¡ï¼Œæ‰€æœ‰æèµ äººå‘˜éƒ½ä¼šæ”¾å…¥è‡´è°¢ä¸­ã€‚éå¸¸æ„Ÿè°¢ï½ <div class="donate"><!--[--><span role="img" aria-label="wechat" style="font-size:36px;color:#64b687;" class="anticon anticon-wechat" tabindex="-1"><svg focusable="false" style="" data-icon="wechat" width="1em" height="1em" fill="currentColor" aria-hidden="true" viewBox="64 64 896 896"><path d="M690.1 377.4c5.9 0 11.8.2 17.6.5-24.4-128.7-158.3-227.1-319.9-227.1C209 150.8 64 271.4 64 420.2c0 81.1 43.6 154.2 111.9 203.6a21.5 21.5 0 019.1 17.6c0 2.4-.5 4.6-1.1 6.9-5.5 20.3-14.2 52.8-14.6 54.3-.7 2.6-1.7 5.2-1.7 7.9 0 5.9 4.8 10.8 10.8 10.8 2.3 0 4.2-.9 6.2-2l70.9-40.9c5.3-3.1 11-5 17.2-5 3.2 0 6.4.5 9.5 1.4 33.1 9.5 68.8 14.8 105.7 14.8 6 0 11.9-.1 17.8-.4-7.1-21-10.9-43.1-10.9-66 0-135.8 132.2-245.8 295.3-245.8zm-194.3-86.5c23.8 0 43.2 19.3 43.2 43.1s-19.3 43.1-43.2 43.1c-23.8 0-43.2-19.3-43.2-43.1s19.4-43.1 43.2-43.1zm-215.9 86.2c-23.8 0-43.2-19.3-43.2-43.1s19.3-43.1 43.2-43.1 43.2 19.3 43.2 43.1-19.4 43.1-43.2 43.1zm586.8 415.6c56.9-41.2 93.2-102 93.2-169.7 0-124-120.8-224.5-269.9-224.5-149 0-269.9 100.5-269.9 224.5S540.9 847.5 690 847.5c30.8 0 60.6-4.4 88.1-12.3 2.6-.8 5.2-1.2 7.9-1.2 5.2 0 9.9 1.6 14.3 4.1l59.1 34c1.7 1 3.3 1.7 5.2 1.7a9 9 0 006.4-2.6 9 9 0 002.6-6.4c0-2.2-.9-4.4-1.4-6.6-.3-1.2-7.6-28.3-12.2-45.3-.5-1.9-.9-3.8-.9-5.7.1-5.9 3.1-11.2 7.6-14.5zM600.2 587.2c-19.9 0-36-16.1-36-35.9 0-19.8 16.1-35.9 36-35.9s36 16.1 36 35.9c0 19.8-16.2 35.9-36 35.9zm179.9 0c-19.9 0-36-16.1-36-35.9 0-19.8 16.1-35.9 36-35.9s36 16.1 36 35.9a36.08 36.08 0 01-36 35.9z"></path></svg><!----></span><!----><!--]--><!--[--><span role="img" aria-label="alipay-circle" style="font-size:36px;color:#08c;" class="anticon anticon-alipay-circle" tabindex="-1"><svg focusable="false" style="" data-icon="alipay-circle" width="1em" height="1em" fill="currentColor" aria-hidden="true" fill-rule="evenodd" viewBox="64 64 896 896"><path d="M512 64c247.42 0 448 200.58 448 448S759.42 960 512 960 64 759.42 64 512 264.58 64 512 64m32.5 168c-69.67 0-86.06 16.84-86.72 39.08l-.02 1.43v46.62H291.45c-9.92 0-14.28 23.05-14.27 39.3 0 2.7 2.08 4.93 4.77 4.93h175.81v58.3h-116.5c-9.96 0-14.3 23.76-14.27 39.47a4.77 4.77 0 004.77 4.76h233.45c-4.53 41.06-15.43 77.59-30.72 109.32l-1.22 2.5-.32-.28c-60.24-28.47-120.43-52.57-194.4-52.57l-2.62.01c-84.98 1.11-144.71 56.5-145.91 127.04l-.02 1.22.02 2.13c1.24 70.4 63.56 126.45 148.52 126.45 61.25 0 116.38-16.85 163.46-45.02a138.58 138.58 0 0014.07-7.96 345.6 345.6 0 0050.3-41.16l9.45 6.35 12.46 8.32c57.53 38.26 113.76 72.62 169.86 79.27a142.62 142.62 0 0018.31 1.16c43.02 0 55-52.68 57.39-95.51l.14-2.84c.4-8.46-6.2-15.6-14.65-15.86-75.46-2.37-136.45-22.05-192-46.11l-6.27-2.75c35.15-56.8 56.66-121.81 57.15-186.66l.09-1.08c.4-5.51-4-10.2-9.52-10.2H549.33v-58.3h165.73c9.92 0 14.28-22.12 14.27-39.31a4.85 4.85 0 00-4.78-4.92H549.32v-82.35a4.8 4.8 0 00-4.83-4.78M328 583.85c54.63 0 107.08 22.41 158.1 52.19l5.76 3.4c-103.57 119.84-247.17 95.9-261.72 26.37a66.89 66.89 0 01-1.14-9.83l-.06-2.34.02-.9c.97-40.12 45.33-68.9 99.04-68.9"></path></svg><!----></span><!----><!--]--></div> ä¹Ÿå¯å…³æ³¨æˆ‘çš„å…¬ä¼—å·ï¼Œä¼šæŒç»­åˆ†äº«å­¦ä¹ å’Œç”Ÿæ´»çš„æ„Ÿæ‚Ÿ~ <div class="mp"><div><!--[--><div class="ant-image css-1p3hq3p" style="height:150px;"><img height="150" class="ant-image-img" style="height:150px;" src="/react-docs/images/mp.png"><!----><div class="ant-image-mask"><!--[--><div class="ant-image-mask-info"><span role="img" aria-label="eye" class="anticon anticon-eye"><svg focusable="false" style="" data-icon="eye" width="1em" height="1em" fill="currentColor" aria-hidden="true" viewBox="64 64 896 896"><path d="M942.2 486.2C847.4 286.5 704.1 186 512 186c-192.2 0-335.4 100.5-430.2 300.3a60.3 60.3 0 000 51.5C176.6 737.5 319.9 838 512 838c192.2 0 335.4-100.5 430.2-300.3 7.7-16.2 7.7-35 0-51.5zM512 766c-161.3 0-279.4-81.8-362.7-254C232.6 339.8 350.7 258 512 258c161.3 0 279.4 81.8 362.7 254C791.5 684.2 673.4 766 512 766zm-4-430c-97.2 0-176 78.8-176 176s78.8 176 176 176 176-78.8 176-176-78.8-176-176-176zm0 288c-61.9 0-112-50.1-112-112s50.1-112 112-112 112 50.1 112 112-50.1 112-112 112z"></path></svg><!----></span>Preview</div><!--]--></div></div><!----><!--]--></div></div></div><!--]--><!--]--><!--]--><!--]--><div class="edit-info" data-v-e257564d><div class="edit-link" data-v-e257564d><a class="VPLink link vp-external-link-icon no-icon edit-link-button" href="https://github.com/xzy0625/react-docs/tree/master/docs/blogs/mount/åˆæ¬¡æ¸²æŸ“.md" target="_blank" rel="noreferrer" data-v-e257564d><!--[--><span class="vpi-square-pen edit-link-icon" data-v-e257564d></span> Edit this page on GitHub<!--]--></a></div><div class="last-updated" data-v-e257564d><p class="VPLastUpdated" data-v-e257564d data-v-e98dd255>æœ€è¿‘æ›´æ–°æ—¶é—´: <time datetime="2024-12-16T11:43:51.000Z" data-v-e98dd255></time></p></div></div><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-e257564d><span class="visually-hidden" id="doc-footer-aria-label" data-v-e257564d>Pager</span><div class="pager" data-v-e257564d><a class="VPLink link pager-link prev" href="/react-docs/blogs/start/%E9%9A%8F%E6%84%8F%E8%AE%B0%E5%BD%95.html" data-v-e257564d><!--[--><span class="desc" data-v-e257564d>ä¸Šä¸€ç¯‡</span><span class="title" data-v-e257564d>éšæ„è®°å½•</span><!--]--></a></div><div class="pager" data-v-e257564d><a class="VPLink link pager-link next" href="/react-docs/blogs/update/index.html" data-v-e257564d><!--[--><span class="desc" data-v-e257564d>ä¸‹ä¸€ç¯‡</span><span class="title" data-v-e257564d>æ›´æ–°æ¦‚è§ˆ</span><!--]--></a></div></nav></footer><!--[--><!--[--><!--[--><div class="comments"><!----></div><!--]--><!--]--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-5d98c3a5 data-v-e315a0ad><div class="container" data-v-e315a0ad><p class="message" data-v-e315a0ad>Released under the MIT License.</p><p class="copyright" data-v-e315a0ad>Copyright Â© 2023-present react-docs</p></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"blogs_classcomp_index.md\":\"BccTOM97\",\"blogs_evnetsystem_eventsystem.md\":\"CRibfofP\",\"blogs_example_clickandtransition.md\":\"BoQwGLO6\",\"blogs_example_å¥‡æ€ªçš„useeffect.md\":\"DF30PSm3\",\"blogs_functioncomp_index.md\":\"Bui3pCxT\",\"blogs_hooks_index.md\":\"B8uMSv1D\",\"blogs_hooks_usestate.md\":\"Dy83Xcqj\",\"blogs_lanes_index.md\":\"CXHNledX\",\"blogs_mount_åˆæ¬¡æ¸²æŸ“.md\":\"Da09jFKp\",\"blogs_othercomp_teleport.md\":\"BnYtXVKH\",\"blogs_performace_index.md\":\"Do8p8DF_\",\"blogs_schduler_scheduler_and_concurrent.md\":\"Bygex_kJ\",\"blogs_start_ä¸ºä»€ä¹ˆå­¦ä¹ æºç .md\":\"Dvw1YxxY\",\"blogs_start_å‚è€ƒèµ„æ–™.md\":\"C-0BfS4l\",\"blogs_start_å¦‚ä½•è°ƒè¯•æºç .md\":\"4ue15VoR\",\"blogs_start_æºç ç»“æ„.md\":\"CqYOrg2Q\",\"blogs_start_éšæ„è®°å½•.md\":\"DbIS_3pF\",\"blogs_summary_å„ç§å…ƒç´ çš„fiberèŠ‚ç‚¹å±æ€§.md\":\"Cq9IkxDY\",\"blogs_summary_æ¸²æŸ“æ€»ç»“.md\":\"D6wLMxCu\",\"blogs_summary_è·å–å­å…ƒç´ æ€»ç»“.md\":\"DGV9zv8q\",\"blogs_update_index.md\":\"Df2PlKaG\",\"index.md\":\"DrbG-gha\",\"others_changelog.md\":\"YAOh9NnE\",\"others_contribution.md\":\"gQReKx8D\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"react18æºç è§£æ\",\"description\":\"reactç›¸å…³å­¦ä¹ æ–‡æ¡£\",\"base\":\"/react-docs/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"logo\":\"/images/logo.png\",\"algolia\":{\"appId\":\"W89ZSBPTZN\",\"apiKey\":\"38d78106e5e486959bba0748b3378d84\",\"indexName\":\"react-docs\",\"placeholder\":\"è¯·è¾“å…¥å…³é”®è¯\",\"buttonText\":\"æœç´¢\"},\"nav\":[{\"text\":\"ğŸ”¥å‰ç«¯ç®—æ³•(ç¼–å†™ä¸­)\",\"link\":\"/blogs/blog1/\"},{\"text\":\"ğŸ’­å­¦ä¹ åœˆå­(ç¼–å†™ä¸­)\",\"link\":\"/blogs/blog1/\"},{\"text\":\"å…¶ä»–\",\"items\":[{\"text\":\"Changelog\",\"link\":\"/others/changelog\"},{\"text\":\"Contribution\",\"link\":\"/others/contribution\"}]}],\"sidebar\":[{\"text\":\"å¼€å§‹\",\"collapsed\":true,\"items\":[{\"text\":\"ä¸ºä»€ä¹ˆè¦å­¦ä¹ æºç \",\"link\":\"/blogs/start/ä¸ºä»€ä¹ˆå­¦ä¹ æºç \"},{\"text\":\"æºç ç»“æ„\",\"link\":\"/blogs/start/æºç ç»“æ„\"},{\"text\":\"å¦‚ä½•è°ƒè¯•æºç \",\"link\":\"/blogs/start/å¦‚ä½•è°ƒè¯•æºç \"},{\"text\":\"å‚è€ƒèµ„æ–™\",\"link\":\"/blogs/start/å‚è€ƒèµ„æ–™\"},{\"text\":\"éšæ„è®°å½•\",\"link\":\"/blogs/start/éšæ„è®°å½•\"}]},{\"text\":\"åˆæ¬¡æ¸²æŸ“\",\"collapsed\":true,\"items\":[{\"text\":\"åˆæ¬¡æ¸²æŸ“æ¦‚è§ˆ\",\"link\":\"/blogs/mount/åˆæ¬¡æ¸²æŸ“\"}]},{\"text\":\"æ›´æ–°\",\"collapsed\":true,\"items\":[{\"text\":\"æ›´æ–°æ¦‚è§ˆ\",\"link\":\"/blogs/update/index\"}]},{\"text\":\"è°ƒåº¦å™¨scheduler\",\"collapsed\":true,\"items\":[{\"text\":\"è°ƒåº¦å™¨å’Œå¹¶å‘æœºåˆ¶\",\"link\":\"/blogs/schduler/scheduler_and_concurrent\"}]},{\"text\":\"äº‹ä»¶ç³»ç»Ÿ\",\"collapsed\":true,\"items\":[{\"text\":\"äº‹ä»¶ç³»ç»Ÿæ¦‚è§ˆ\",\"link\":\"/blogs/evnetSystem/eventSystem\"}]},{\"text\":\"å‡½æ•°ç»„ä»¶\",\"collapsed\":true,\"items\":[{\"text\":\"å‡½æ•°ç»„ä»¶æ¦‚è§ˆ\",\"link\":\"/blogs/functionComp/index\"}]},{\"text\":\"ç±»ç»„ä»¶\",\"collapsed\":true,\"items\":[{\"text\":\"ç±»ç»„ä»¶æ¦‚è§ˆ\",\"link\":\"/blogs/classComp/index\"}]},{\"text\":\"å…¶ä»–ç»„ä»¶\",\"collapsed\":true,\"items\":[{\"text\":\"teleport\",\"link\":\"/blogs/otherComp/teleport\"}]},{\"text\":\"hooks\",\"collapsed\":true,\"items\":[{\"text\":\"hooksæ¦‚è§ˆ\",\"link\":\"/blogs/hooks/index\"},{\"text\":\"useState\",\"link\":\"/blogs/hooks/useState\"}]},{\"text\":\"ä¼˜å…ˆçº§\",\"collapsed\":true,\"items\":[{\"text\":\"ä¼˜å…ˆçº§\",\"link\":\"/blogs/lanes/index\"}]},{\"text\":\"å…¶ä»–ä¸€äº›æ€»ç»“\",\"collapsed\":true,\"items\":[{\"text\":\"å„ç§å…ƒç´ çš„fiberèŠ‚ç‚¹å±æ€§\",\"link\":\"/blogs/summary/å„ç§å…ƒç´ çš„fiberèŠ‚ç‚¹å±æ€§\"},{\"text\":\"è·å–å­å…ƒç´ æ€»ç»“\",\"link\":\"/blogs/summary/è·å–å­å…ƒç´ æ€»ç»“\"},{\"text\":\"æ¸²æŸ“æ€»ç»“\",\"link\":\"/blogs/summary/æ¸²æŸ“æ€»ç»“\"}]},{\"text\":\"æ€§èƒ½æå‡\",\"collapsed\":true,\"items\":[{\"text\":\"æ€§èƒ½æå‡\",\"link\":\"/blogs/performace/index\"}]},{\"text\":\"ä¸€äº›ä¾‹å­\",\"collapsed\":true,\"items\":[{\"text\":\"reactåŸç”Ÿé˜²æŠ–æ€ªè±¡\",\"link\":\"/blogs/example/clickAndTransition\"},{\"text\":\"å¥‡æ€ªçš„useEffect\",\"link\":\"/blogs/example/å¥‡æ€ªçš„useEffect\"}]}],\"docFooter\":{\"prev\":\"ä¸Šä¸€ç¯‡\",\"next\":\"ä¸‹ä¸€ç¯‡\"},\"footer\":{\"message\":\"Released under the MIT License.\",\"copyright\":\"Copyright Â© 2023-present react-docs\"},\"lastUpdatedText\":\"æœ€è¿‘æ›´æ–°æ—¶é—´\",\"editLink\":{\"pattern\":\"https://github.com/xzy0625/react-docs/tree/master/docs/:path\",\"text\":\"Edit this page on GitHub\"},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/xzy0625/react-docs\"}]},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>